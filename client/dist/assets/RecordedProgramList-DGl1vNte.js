import{d as Z,k as b,h as r,a,b as e,w as R,r as Y,c as m,e as _,t as n,y as H,U as L,P as W,Q as be,F as A,o as d,R as j,_ as ee,q as U,E as B,s as N,G as we,l as u,ai as ce,aj as ge,z as K,J as _e,ak as se,V as Q,al as xe,am as ke,M,an as ve,u as $e,n as q,f as pe,p as O,j as Ve,L as Me,g as Ce,O as He}from"./index-CQ2c3tog.js";import{V as le}from"./VDialog-v4AtlV_q.js";import{a as ne,V as ue,b as he,c as ye}from"./VCard-dYI7Rebj.js";import{V as me}from"./ssrBoot-B7k1dIYN.js";import{V as ie,a as J}from"./VRow-DLXADF5R.js";import{c as X,V as T,b as Be,a as I,d as Se}from"./VSelect-BX1mUtDD.js";import{V as Te,a as Pe}from"./VPagination-z0yySnuW.js";import{V as Re}from"./VTooltip-DxuOaqiO.js";import{V as de}from"./Videos-NcDZ8iOa.js";import{V as fe}from"./VDivider-B0OsrUyy.js";const ze={class:"px-5 pb-6"},Ee={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-2"},Ie={class:"video-info__item"},Le={class:"video-info__item-value"},De={class:"video-info__item"},Ue={class:"video-info__item-value"},Ae={class:"video-info__item"},Fe={class:"video-info__item-value"},Oe={class:"video-info__item"},We={class:"video-info__item-value"},je={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},qe={class:"video-info__item"},Ge={class:"video-info__item-value"},Ne={class:"video-info__item"},Ye={class:"video-info__item-value"},Qe={class:"video-info__item"},Je={class:"video-info__item-value"},Ke={class:"video-info__item"},Xe={class:"video-info__item-value"},Ze={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},et={class:"video-info__item"},tt={class:"video-info__item-value"},ot={class:"video-info__item"},at={class:"video-info__item-value"},rt={class:"video-info__item"},st={class:"video-info__item-value"},it={key:0,class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},dt={class:"video-info__item"},lt={class:"video-info__item-value"},nt={class:"video-info__item"},ut={class:"video-info__item-value"},mt={class:"video-info__item"},ct={class:"video-info__item-value"},gt=Z({__name:"RecordedFileInfoDialog",props:{program:{},show:{type:Boolean}},emits:["update:show"],setup(t){return(x,s)=>{const w=Y("Icon");return d(),b(le,{"max-width":"770",transition:"slide-y-transition","model-value":t.show,"onUpdate:modelValue":s[1]||(s[1]=k=>x.$emit("update:show",k))},{default:r(()=>[a(ne,{class:"video-info"},{default:r(()=>[a(ue,{class:"px-5 pt-6 pb-3 d-flex align-center font-weight-bold",style:{height:"60px"}},{default:r(()=>[a(w,{icon:"fluent:document-20-filled",height:"26px"}),s[2]||(s[2]=e("span",{class:"ml-3"},"録画ファイル情報",-1)),a(me),R((d(),m("div",{class:"d-flex align-center rounded-circle cursor-pointer px-2 py-2",onClick:s[0]||(s[0]=k=>x.$emit("update:show",!1))},[a(w,{icon:"fluent:dismiss-12-filled",width:"23px",height:"23px"})])),[[j]])]),_:1}),e("div",ze,[e("div",Ee,[a(w,{icon:"fluent:video-clip-20-filled",width:"24px",height:"20px"}),s[3]||(s[3]=e("span",{class:"ml-2"},"ファイル情報",-1))]),e("div",Ie,[s[4]||(s[4]=e("div",{class:"video-info__item-label"},"ファイルパス",-1)),e("div",Le,n(t.program.recorded_video.file_path),1)]),e("div",De,[s[5]||(s[5]=e("div",{class:"video-info__item-label"},"ファイルサイズ",-1)),e("div",Ue,n(H(L).formatBytes(t.program.recorded_video.file_size)),1)]),e("div",Ae,[s[6]||(s[6]=e("div",{class:"video-info__item-label"},"録画期間",-1)),e("div",Fe,n(H(W).getRecordingTime(t.program)),1)]),e("div",Oe,[s[7]||(s[7]=e("div",{class:"video-info__item-label"},"最終更新日時",-1)),e("div",We,n(H(L).apply28HourClock(H(be)(t.program.recorded_video.file_modified_at).format("YYYY/MM/DD (dd) HH:mm:ss"))),1)]),e("div",je,[a(w,{icon:"fluent:video-20-filled",width:"24px",height:"20px"}),s[8]||(s[8]=e("span",{class:"ml-2"},"映像情報",-1))]),e("div",qe,[s[9]||(s[9]=e("div",{class:"video-info__item-label"},"コーデック",-1)),e("div",Ge,n(t.program.recorded_video.video_codec)+" ("+n(t.program.recorded_video.video_codec_profile)+")",1)]),e("div",Ne,[s[10]||(s[10]=e("div",{class:"video-info__item-label"},"解像度",-1)),e("div",Ye,n(t.program.recorded_video.video_resolution_width)+"×"+n(t.program.recorded_video.video_resolution_height),1)]),e("div",Qe,[s[11]||(s[11]=e("div",{class:"video-info__item-label"},"フレームレート",-1)),e("div",Je,n(t.program.recorded_video.video_frame_rate)+" fps",1)]),e("div",Ke,[s[12]||(s[12]=e("div",{class:"video-info__item-label"},"スキャン方式",-1)),e("div",Xe,n(t.program.recorded_video.video_scan_type),1)]),e("div",Ze,[a(w,{icon:"fluent:speaker-2-20-filled",width:"24px",height:"20px"}),s[13]||(s[13]=e("span",{class:"ml-2"},"音声情報（主音声）",-1))]),e("div",et,[s[14]||(s[14]=e("div",{class:"video-info__item-label"},"コーデック",-1)),e("div",tt,n(t.program.recorded_video.primary_audio_codec),1)]),e("div",ot,[s[15]||(s[15]=e("div",{class:"video-info__item-label"},"チャンネル",-1)),e("div",at,n(t.program.recorded_video.primary_audio_channel),1)]),e("div",rt,[s[16]||(s[16]=e("div",{class:"video-info__item-label"},"サンプリングレート",-1)),e("div",st,n(t.program.recorded_video.primary_audio_sampling_rate?`${t.program.recorded_video.primary_audio_sampling_rate/1e3}kHz`:"不明"),1)]),t.program.recorded_video.secondary_audio_codec?(d(),m("div",it,[a(w,{icon:"fluent:speaker-2-20-filled",width:"24px",height:"20px"}),s[17]||(s[17]=e("span",{class:"ml-2"},"音声情報（副音声）",-1))])):_("",!0),t.program.recorded_video.secondary_audio_codec?(d(),m(A,{key:1},[e("div",dt,[s[18]||(s[18]=e("div",{class:"video-info__item-label"},"コーデック",-1)),e("div",lt,n(t.program.recorded_video.secondary_audio_codec),1)]),e("div",nt,[s[19]||(s[19]=e("div",{class:"video-info__item-label"},"チャンネル",-1)),e("div",ut,n(t.program.recorded_video.secondary_audio_channel),1)]),e("div",mt,[s[20]||(s[20]=e("div",{class:"video-info__item-label"},"サンプリングレート",-1)),e("div",ct,n(t.program.recorded_video.secondary_audio_sampling_rate?`${t.program.recorded_video.secondary_audio_sampling_rate/1e3}kHz`:"不明"),1)])],64)):_("",!0)])]),_:1})]),_:1},8,["model-value"])}}}),vt=ee(gt,[["__scopeId","data-v-904f7233"]]),pt={class:"encoding-dialog__program-info mb-4"},ft={class:"encoding-dialog__program-title"},_t={key:0,class:"encoding-dialog__program-meta"},ht={class:"encoding-dialog__program-channel"},yt={class:"encoding-dialog__program-time"},bt={class:"encoding-dialog__settings"},wt={class:"d-flex align-center"},xt={class:"text-caption"},kt={class:"d-flex align-center"},$t={class:"text-caption"},Vt={class:"d-flex align-center"},Mt={class:"text-caption"},Ct={class:"d-flex align-center"},Ht=Z({__name:"TSReplaceEncodingDialog",props:{show:{type:Boolean,default:!1},program:{}},emits:["update:show","encoding-started"],setup(t,{emit:x}){const s=t,w=x,k=U({get:()=>s.show,set:$=>w("update:show",$)}),c=B(!1),S=B(!1),v=B("h264"),l=B("software"),C=B("medium"),f=B(!1),te=[{value:"h264",label:"H.264 (AVC)",description:"互換性が高く、多くのデバイスで再生可能",recommended:!0},{value:"hevc",label:"H.265 (HEVC)",description:"より高い圧縮効率、ファイルサイズが小さくなる",recommended:!1}],oe=U(()=>[{value:"software",label:"ソフトウェアエンコード",description:"FFmpegを使用、時間がかかる",disabled:!1,fast:!1},{value:"hardware",label:"ハードウェアエンコード",description:S.value?"GPU/専用チップを使用、高速で高品質":"使用できません（対応するGPUが検出されませんでした）",disabled:!S.value,fast:!0}]),ae=[{value:"fast",label:"高速",description:"エンコード時間を優先、品質は標準的",recommended:!1},{value:"medium",label:"標準",description:"バランスの取れた設定",recommended:!0},{value:"slow",label:"高品質",description:"品質を優先、エンコード時間は長くなる",recommended:!1}],G=U(()=>!(c.value||!s.program||s.program.recorded_video.is_tsreplace_encoded||l.value==="hardware"&&!S.value)),P=async()=>{try{const $=await xe.fetchHardwareEncoderStatus();S.value=$.hardware_encoder_available,!$.hardware_encoder_available&&l.value==="hardware"&&(l.value="software")}catch($){console.error("Failed to check hardware encoder availability:",$),S.value=!1,l.value==="hardware"&&(l.value="software")}},re=async()=>{var $,i;if(!(!s.program||!G.value)){c.value=!0;try{const V=await ke.startManualEncoding({video_id:s.program.id,codec:v.value,encoder_type:l.value,quality_preset:C.value,delete_original:f.value});V&&V.success&&V.task_id?(M.success("エンコードを開始しました。"),w("encoding-started",V.task_id,v.value,l.value),c.value=!1,F()):M.error("エンコードの開始に失敗しました。")}catch(V){if(console.error("Failed to start encoding:",V),(i=($=V==null?void 0:V.response)==null?void 0:$.data)!=null&&i.detail){const z=V.response.data.detail;z==="Cannot re-encode already encoded video"?M.error("再エンコード済みの動画は再度エンコードできません。"):M.error(`エンコードの開始に失敗しました: ${z}`)}else M.error("エンコードの開始に失敗しました。")}finally{c.value=!1}}},F=()=>{c.value||(k.value=!1)};return N(()=>s.show,$=>{$&&(P(),v.value="h264",l.value="software",C.value="medium",f.value=!1,c.value=!1)}),we(()=>{P()}),($,i)=>{const V=Y("Icon");return d(),b(le,{modelValue:k.value,"onUpdate:modelValue":i[4]||(i[4]=z=>k.value=z),"max-width":"600",persistent:""},{default:r(()=>[a(ne,null,{default:r(()=>[a(ue,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:r(()=>[...i[5]||(i[5]=[u(" 録画ファイルを再エンコード ",-1)])]),_:1}),a(he,{class:"pt-4 pb-0"},{default:r(()=>{var z,g,o,p;return[e("div",pt,[e("div",ft,n(((z=t.program)==null?void 0:z.title)||"取得中..."),1),t.program?(d(),m("div",_t,[e("span",ht,n(((g=t.program.channel)==null?void 0:g.name)||"チャンネル情報なし"),1),e("span",yt,n(H(W).getProgramTime(t.program)),1)])):_("",!0)]),e("div",bt,[a(ie,null,{default:r(()=>[a(J,{cols:"12",md:"6"},{default:r(()=>[a(X,{modelValue:v.value,"onUpdate:modelValue":i[0]||(i[0]=h=>v.value=h),items:te,"item-title":"label","item-value":"value",label:"エンコードコーデック",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:c.value},{item:r(({props:h,item:y})=>[a(T,ce(ge(h)),{title:r(()=>[e("div",wt,[e("span",null,n(y.raw.label),1),y.raw.recommended?(d(),b(K,{key:0,size:"x-small",color:"primary",class:"ml-2"},{default:r(()=>[...i[6]||(i[6]=[u(" 推奨 ",-1)])]),_:1})):_("",!0)])]),subtitle:r(()=>[e("span",xt,n(y.raw.description),1)]),_:2},1040)]),_:1},8,["modelValue","disabled"])]),_:1}),a(J,{cols:"12",md:"6"},{default:r(()=>[a(X,{modelValue:l.value,"onUpdate:modelValue":i[1]||(i[1]=h=>l.value=h),items:oe.value,"item-title":"label","item-value":"value",label:"エンコーダータイプ",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:c.value},{item:r(({props:h,item:y})=>[a(T,_e(h,{disabled:y.raw.disabled}),{title:r(()=>[e("div",kt,[e("span",null,n(y.raw.label),1),y.raw.fast?(d(),b(K,{key:0,size:"x-small",color:"success",class:"ml-2"},{default:r(()=>[...i[7]||(i[7]=[u(" 高速 ",-1)])]),_:1})):_("",!0)])]),subtitle:r(()=>[e("span",$t,n(y.raw.description),1)]),_:2},1040,["disabled"])]),_:1},8,["modelValue","items","disabled"])]),_:1})]),_:1}),a(ie,null,{default:r(()=>[a(J,{cols:"12"},{default:r(()=>[a(X,{modelValue:C.value,"onUpdate:modelValue":i[2]||(i[2]=h=>C.value=h),items:ae,"item-title":"label","item-value":"value",label:"エンコード品質",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:c.value},{item:r(({props:h,item:y})=>[a(T,ce(ge(h)),{title:r(()=>[e("div",Vt,[e("span",null,n(y.raw.label),1),y.raw.recommended?(d(),b(K,{key:0,size:"x-small",color:"primary",class:"ml-2"},{default:r(()=>[...i[8]||(i[8]=[u(" 推奨 ",-1)])]),_:1})):_("",!0)])]),subtitle:r(()=>[e("span",Mt,n(y.raw.description),1)]),_:2},1040)]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),!S.value&&l.value==="hardware"?(d(),b(se,{key:0,type:"warning",variant:"tonal",class:"mt-4"},{title:r(()=>[...i[9]||(i[9]=[u("ハードウェアエンコーダーが利用できません",-1)])]),default:r(()=>[i[10]||(i[10]=u(" ハードウェアエンコーダーが検出されないか、設定で無効になっています。",-1)),i[11]||(i[11]=e("br",null,null,-1)),i[12]||(i[12]=u(" ソフトウェアエンコードを使用してください。 ",-1))]),_:1})):_("",!0),(o=t.program)!=null&&o.recorded_video.is_tsreplace_encoded?(d(),b(se,{key:1,type:"error",variant:"tonal",class:"mt-4"},{title:r(()=>[...i[13]||(i[13]=[u("再エンコード済みの動画です",-1)])]),default:r(()=>[i[14]||(i[14]=u(" この録画ファイルは既に再エンコード済みです。",-1)),i[15]||(i[15]=e("br",null,null,-1)),i[16]||(i[16]=u(" 再エンコード済みの動画は再度エンコードできません。 ",-1))]),_:1})):((p=t.program)==null?void 0:p.recorded_video.video_codec)!=="MPEG-2"?(d(),b(se,{key:2,type:"info",variant:"tonal",class:"mt-4"},{title:r(()=>[...i[17]||(i[17]=[u("既にエンコード済みのファイルです",-1)])]),default:r(()=>{var h;return[u(" この録画ファイルは既に "+n((h=t.program)==null?void 0:h.recorded_video.video_codec)+" でエンコードされています。",1),i[18]||(i[18]=e("br",null,null,-1)),i[19]||(i[19]=u(" 再エンコードすると画質が劣化する可能性があります。 ",-1))]}),_:1})):_("",!0),a(ie,{class:"mt-4"},{default:r(()=>[a(J,{cols:"12"},{default:r(()=>[a(Te,{modelValue:f.value,"onUpdate:modelValue":i[3]||(i[3]=h=>f.value=h),disabled:c.value,label:"エンコード完了後に元ファイルを削除する","hide-details":"auto"},{label:r(()=>[e("div",Ct,[i[21]||(i[21]=e("span",null,"エンコード完了後に元ファイルを削除する",-1)),a(Re,{activator:"parent",location:"top"},{default:r(()=>[...i[20]||(i[20]=[e("span",null,[u("チェックすると、エンコード完了後に元のファイルが自動的に削除されます。"),e("br"),u(" 削除されたファイルは復元できませんので、十分注意してください。")],-1)])]),_:1})])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})])]}),_:1}),a(ye,{class:"pt-4 px-6 pb-6"},{default:r(()=>[a(me),a(Q,{color:"text",variant:"text",onClick:F,disabled:c.value},{default:r(()=>[a(V,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),i[22]||(i[22]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1},8,["disabled"]),a(Q,{class:"px-3",color:"primary",variant:"flat",onClick:re,disabled:!G.value,loading:c.value},{default:r(()=>[a(V,{icon:"fluent:arrow-sync-20-regular",width:"18px",height:"18px"}),i[23]||(i[23]=e("span",{class:"ml-1"},"エンコード開始",-1))]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Bt=ee(Ht,[["__scopeId","data-v-b3c29d59"]]),St={class:"recorded-program__container"},Tt={class:"recorded-program__thumbnail"},Pt=["src"],Rt={class:"recorded-program__thumbnail-duration"},zt={key:0,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--recording"},Et={key:1,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--failed"},It={key:2,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--analyzing"},Lt={key:3,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--partial"},Dt={key:4,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--encoding"},Ut={key:5,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--encoded"},At={key:6,class:"recorded-program__thumbnail-progress"},Ft={key:7,class:"recorded-program__thumbnail-progress recorded-program__thumbnail-progress--encoding"},Ot={class:"recorded-program__content"},Wt=["innerHTML"],jt={class:"recorded-program__content-meta"},qt={key:0,class:"recorded-program__content-meta-broadcaster"},Gt=["src"],Nt={class:"recorded-program__content-meta-broadcaster-name"},Yt={key:1,class:"recorded-program__content-meta-broadcaster"},Qt={key:2,class:"recorded-program__content-meta-encoded"},Jt={class:"recorded-program__content-meta-time"},Kt=["innerHTML"],Xt={key:0,width:"22px",height:"22px",viewBox:"0 0 16 16"},Zt={key:0,width:"22px",height:"22px",viewBox:"0 0 16 16"},eo={key:1,width:"22px",height:"22px",viewBox:"0 0 15.2 15.2"},to={class:"recorded-program__menu"},oo={class:"delete-confirmation__file-path mb-4"},ao=Z({__name:"RecordedProgram",props:{program:{},forMylist:{type:Boolean,default:!1},forWatchedHistory:{type:Boolean,default:!1}},emits:["deleted","encoding-started"],setup(t,{emit:x}){const s=t,w=x,k=B(!1),c=B(!1),S=B(!1),v=ve(),l=U(()=>v.getAllTasks().some(o=>o.programTitle===s.program.title&&["queued","processing"].includes(o.status))),C=U(()=>{const o=v.getAllTasks().find(p=>p.programTitle===s.program.title&&["queued","processing"].includes(p.status));return o?{progress:o.progress,status:o.status,codec:o.codec,encoderType:o.encoderType}:null}),f=(g="original")=>{const o=`${L.api_base_url}/videos/${s.program.id}/download?file_type=${g}`;window.location.href=o},te=()=>{S.value=!0},oe=(g,o,p)=>{ve().addTask(g,s.program.title,o,p),w("encoding-started",g),console.log("Encoding started with task ID:",g)},ae=async()=>{M.success("メタデータの再解析を開始します。完了までしばらくお待ちください。"),await de.reanalyzeVideo(s.program.id)===!0&&M.success("メタデータの再解析が完了しました。")},G=async(g=!1)=>{M.success("サムネイルの再作成を開始しました。完了までしばらくお待ちください。"),await de.regenerateThumbnail(s.program.id,g)===!0&&M.success("サムネイルの再作成が完了しました。")},P=$e(),re=()=>{P.settings.mylist.some(o=>o.type==="RecordedProgram"&&o.id===s.program.id)?(P.settings.mylist=P.settings.mylist.filter(o=>!(o.type==="RecordedProgram"&&o.id===s.program.id)),M.show("マイリストから削除しました。")):(P.settings.mylist.push({type:"RecordedProgram",id:s.program.id,created_at:L.time()}),M.success("マイリストに追加しました。"))},F=U(()=>P.settings.mylist.some(g=>g.type==="RecordedProgram"&&g.id===s.program.id)),$=U(()=>P.settings.watched_history.find(g=>g.video_id===s.program.id)),i=()=>{P.settings.watched_history=P.settings.watched_history.filter(g=>g.video_id!==s.program.id),M.show("視聴履歴から削除しました。")},V=()=>{const g=Me();if(g.user===null||g.user.is_admin===!1){M.warning(`録画ファイルを削除するには管理者権限が必要です。
管理者アカウントでログインし直してください。`);return}c.value=!0},z=async()=>{c.value=!1,M.info("録画ファイルの削除を開始します。完了までしばらくお待ちください。"),await de.deleteVideo(s.program.id)===!0&&(M.success("録画ファイルを削除しました。"),w("deleted",s.program.id))};return(g,o)=>{const p=Y("Icon"),h=Y("router-link"),y=Ve("ftooltip");return d(),m(A,null,[R((d(),b(h,{class:q(["recorded-program",{"recorded-program--recording":t.program.recorded_video.status==="Recording","recorded-program--analyzing":!t.program.recorded_video.has_key_frames&&t.program.recorded_video.status!=="AnalysisFailed","recorded-program--failed":t.program.recorded_video.status==="AnalysisFailed","recorded-program--encoding":l.value}]),to:t.program.recorded_video.status==="Recorded"&&t.program.recorded_video.has_key_frames||l.value?`/videos/watch/${t.program.id}`:{path:""}},{default:r(()=>{var E;return[e("div",St,[e("div",Tt,[e("img",{class:"recorded-program__thumbnail-image",loading:"lazy",decoding:"async",src:`${H(L).api_base_url}/videos/${t.program.id}/thumbnail`},null,8,Pt),e("div",Rt,n(H(W).getProgramDuration(t.program)),1),t.program.recorded_video.status==="Recording"?(d(),m("div",zt,[...o[14]||(o[14]=[e("div",{class:"recorded-program__thumbnail-status-dot"},null,-1),u(" 録画中 ",-1)])])):t.program.recorded_video.status==="AnalysisFailed"?(d(),m("div",Et,[a(p,{icon:"fluent:error-circle-12-regular",width:"15px",height:"15px"}),o[15]||(o[15]=u(" メタデータ解析失敗 ",-1))])):t.program.recorded_video.has_key_frames?t.program.is_partially_recorded?(d(),m("div",Lt," ⚠️ 一部のみ録画 ")):l.value&&C.value?(d(),m("div",Dt,[a(p,{icon:"fluent:arrow-sync-12-regular",width:"15px",height:"15px",class:"recorded-program__thumbnail-status-icon--spin"}),u(" エンコード中 ("+n(Math.round(C.value.progress))+"%) ",1)])):(E=t.program)!=null&&E.recorded_video.is_tsreplace_encoded?(d(),m("div",Ut,[a(p,{icon:"fluent:checkmark-circle-12-regular",width:"15px",height:"15px"}),o[17]||(o[17]=u(" 再エンコード済み ",-1))])):_("",!0):(d(),m("div",It,[a(p,{icon:"fluent:clock-12-regular",width:"15px",height:"15px"}),o[16]||(o[16]=u(" メタデータ解析中 ",-1))])),$.value&&!l.value?(d(),m("div",At,[e("div",{class:"recorded-program__thumbnail-progress-bar",style:pe(`width: ${$.value.last_playback_position/t.program.recorded_video.duration*100}%`)},null,4)])):l.value&&C.value?(d(),m("div",Ft,[e("div",{class:"recorded-program__thumbnail-progress-bar recorded-program__thumbnail-progress-bar--encoding",style:pe(`width: ${C.value.progress}%`)},null,4)])):_("",!0)]),e("div",Ot,[e("div",{class:"recorded-program__content-title",innerHTML:H(W).decorateProgramInfo(t.program,"title")},null,8,Wt),e("div",jt,[t.program.channel?(d(),m("div",qt,[e("img",{class:"recorded-program__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${H(L).api_base_url}/channels/${t.program.channel.id}/logo`},null,8,Gt),e("span",Nt,"Ch: "+n(t.program.channel.channel_number)+" "+n(t.program.channel.name),1)])):(d(),m("div",Yt,[...o[18]||(o[18]=[e("span",{class:"recorded-program__content-meta-broadcaster-name"},"チャンネル情報なし",-1)])])),t.program.recorded_video.is_tsreplace_encoded?(d(),m("div",Qt,[a(K,{size:"x-small",color:"success",variant:"tonal"},{default:r(()=>[a(p,{icon:"fluent:checkmark-circle-12-regular",width:"12px",height:"12px",class:"mr-1"}),o[19]||(o[19]=u(" 再エンコード済み ",-1))]),_:1})])):_("",!0),e("div",Jt,n(H(W).getProgramTime(t.program)),1)]),e("div",{class:"recorded-program__content-description",innerHTML:H(W).decorateProgramInfo(t.program,"description")},null,8,Kt)]),t.forWatchedHistory?_("",!0):R((d(),m("div",{key:0,class:q(["recorded-program__mylist",{"recorded-program__mylist--highlight":F.value&&!t.forMylist}]),onClick:O(re,["prevent","stop"]),onMousedown:o[0]||(o[0]=O(()=>{},["prevent","stop"]))},[t.forMylist?(d(),m("svg",Xt,[...o[20]||(o[20]=[e("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0M6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0zM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5"},null,-1)])])):(d(),m(A,{key:1},[F.value?(d(),m("svg",Zt,[...o[21]||(o[21]=[e("path",{fill:"currentColor",d:"M14.046 3.486a.75.75 0 0 1-.032 1.06l-7.93 7.474a.85.85 0 0 1-1.188-.022l-2.68-2.72a.75.75 0 1 1 1.068-1.053l2.234 2.267l7.468-7.038a.75.75 0 0 1 1.06.032"},null,-1)])])):(d(),m("svg",eo,[...o[22]||(o[22]=[e("path",{fill:"currentColor",d:"M8 2.5a.5.5 0 0 0-1 0V7H2.5a.5.5 0 0 0 0 1H7v4.5a.5.5 0 0 0 1 0V8h4.5a.5.5 0 0 0 0-1H8z"},null,-1)])]))],64))],34)),[[j],[y,F.value?"マイリストから削除する":"マイリストに追加する"]]),t.forWatchedHistory?R((d(),m("div",{key:1,class:"recorded-program__mylist",onClick:O(i,["prevent","stop"]),onMousedown:o[1]||(o[1]=O(()=>{},["prevent","stop"]))},[...o[23]||(o[23]=[e("svg",{width:"22px",height:"22px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0M6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0zM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5"})],-1)])],32)),[[j],[y,"視聴履歴から削除する"]]):_("",!0),e("div",to,[a(Se,{location:"bottom end","close-on-content-click":!0},{activator:r(({props:D})=>[R((d(),m("div",_e({class:"recorded-program__menu-button"},D,{onClick:o[2]||(o[2]=O(()=>{},["prevent","stop"])),onMousedown:o[3]||(o[3]=O(()=>{},["prevent","stop"]))}),[...o[24]||(o[24]=[e("svg",{width:"19px",height:"19px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M9.5 13a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0"})],-1)])],16)),[[j]])]),default:r(()=>[a(Be,{density:"compact","bg-color":"background-lighten-1",class:"recorded-program__menu-list"},{default:r(()=>[a(T,{onClick:o[4]||(o[4]=D=>k.value=!0)},{prepend:r(()=>[...o[25]||(o[25]=[e("svg",{width:"20px",height:"20px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M8.499 7.5a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0zm.25-2a.749.749 0 1 1-1.499 0a.749.749 0 0 1 1.498 0M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1M2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8"})],-1)])]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...o[26]||(o[26]=[u("録画ファイル情報を表示",-1)])]),_:1})]),_:1}),t.program.recorded_video.is_tsreplace_encoded?(d(),m(A,{key:0},[a(T,{onClick:o[5]||(o[5]=D=>f("original")),disabled:t.program.recorded_video.status==="Recording"||l.value},{prepend:r(()=>[a(p,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[u("元ファイルをダウンロード ("+n(H(L).formatBytes(t.program.recorded_video.file_size))+")",1)]),_:1})]),_:1},8,["disabled"]),a(T,{onClick:o[6]||(o[6]=D=>f("encoded")),disabled:t.program.recorded_video.status==="Recording"||l.value},{prepend:r(()=>[a(p,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...o[27]||(o[27]=[u("エンコード済みファイルをダウンロード",-1)])]),_:1})]),_:1},8,["disabled"])],64)):(d(),b(T,{key:1,onClick:o[7]||(o[7]=D=>f("original")),disabled:t.program.recorded_video.status==="Recording"||l.value},{prepend:r(()=>[a(p,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[u("録画ファイルをダウンロード ("+n(H(L).formatBytes(t.program.recorded_video.file_size))+")",1)]),_:1})]),_:1},8,["disabled"])),R((d(),b(T,{onClick:ae},{prepend:r(()=>[a(p,{icon:"fluent:book-arrow-clockwise-20-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...o[28]||(o[28]=[u("メタデータを再解析",-1)])]),_:1})]),_:1})),[[y,"再生時に必要な録画ファイル情報や番組情報などを解析し直します"]]),R((d(),b(T,{onClick:o[8]||(o[8]=D=>G(!0))},{prepend:r(()=>[a(p,{icon:"fluent:image-arrow-counterclockwise-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...o[29]||(o[29]=[u("サムネイルを更新",-1)])]),_:1})]),_:1})),[[y,"既存のシークバー用サムネイルから代表サムネイルを選び直します 変更反映にはブラウザキャッシュの削除が必要です"]]),R((d(),b(T,{onClick:o[9]||(o[9]=D=>G(!1))},{prepend:r(()=>[a(p,{icon:"fluent:image-arrow-counterclockwise-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...o[30]||(o[30]=[u("サムネイルを再作成",-1)])]),_:1})]),_:1})),[[y,"サムネイルを完全に作り直します（数分かかります） 変更反映にはブラウザキャッシュの削除が必要です"]]),a(fe),R((d(),b(T,{onClick:te,disabled:t.program.recorded_video.status==="Recording"||l.value||t.program.recorded_video.is_tsreplace_encoded},{prepend:r(()=>[a(p,{icon:"fluent:arrow-sync-20-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...o[31]||(o[31]=[u("録画ファイルを再エンコード",-1)])]),_:1})]),_:1},8,["disabled"])),[[y,t.program.recorded_video.is_tsreplace_encoded?"再エンコード済みの動画は再度エンコードできません":"録画ファイルをH.264またはHEVCに再エンコードします"]]),a(fe),a(T,{onClick:V,disabled:t.program.recorded_video.status==="Recording"||l.value,class:"recorded-program__menu-list-item--danger"},{prepend:r(()=>[a(p,{icon:"fluent:delete-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...o[32]||(o[32]=[u("録画ファイルを削除",-1)])]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})])])]}),_:1},8,["to","class"])),[[j]]),a(vt,{program:t.program,show:k.value,"onUpdate:show":o[10]||(o[10]=E=>k.value=E)},null,8,["program","show"]),a(le,{"max-width":"750",modelValue:c.value,"onUpdate:modelValue":o[12]||(o[12]=E=>c.value=E)},{default:r(()=>[a(ne,null,{default:r(()=>[a(ue,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:r(()=>[...o[33]||(o[33]=[u("本当に録画ファイルを削除しますか？",-1)])]),_:1}),a(he,{class:"pt-2 pb-0"},{default:r(()=>[e("div",oo,n(t.program.recorded_video.file_path),1),o[34]||(o[34]=e("div",{class:"text-error-lighten-1 font-weight-bold"},[u(" この録画ファイルに関連するすべてのデータ (サムネイル / .ts.program.txt / .ts.err を含む) が削除されます。"),e("br"),u(" 元に戻すことはできません。本当に録画ファイルを削除しますか？ ")],-1))]),_:1}),a(ye,{class:"pt-4 px-6 pb-6"},{default:r(()=>[a(me),a(Q,{color:"text",variant:"text",onClick:o[11]||(o[11]=E=>c.value=!1)},{default:r(()=>[a(p,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),o[35]||(o[35]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),a(Q,{class:"px-3",color:"error",variant:"flat",onClick:z},{default:r(()=>[a(p,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),o[36]||(o[36]=e("span",{class:"ml-1"},"録画ファイルを削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Bt,{show:S.value,"onUpdate:show":o[13]||(o[13]=E=>S.value=E),program:t.program,onEncodingStarted:oe},null,8,["show","program"])],64)}}}),ro=ee(ao,[["__scopeId","data-v-b7e4cda5"]]),so={key:0,class:"recorded-program-list__header"},io={class:"recorded-program-list__title"},lo={class:"recorded-program-list__title-text"},no={key:1,class:"recorded-program-list__title-count"},uo={class:"recorded-program-list__empty-content"},mo=["innerHTML"],co=["innerHTML"],go={class:"recorded-program-list__grid-content"},vo={key:1,class:"recorded-program-list__pagination"},po=Z({__name:"RecordedProgramList",props:{title:{},programs:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画番組が見つかりませんでした。"},emptySubMessage:{default:'サーバー設定で録画フォルダのパスを<br class="d-sm-none">正しく設定できているか確認してください。'},isLoading:{type:Boolean,default:!1},isSearching:{type:Boolean,default:!1},forMylist:{type:Boolean,default:!1},forWatchedHistory:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more"],setup(t){He();const x=t,s=B(x.page),w=B(x.sortOrder),k=B([...x.programs]),c=B(x.total);N(()=>x.page,v=>{s.value=v}),N(()=>x.sortOrder,v=>{w.value=v}),N(()=>x.programs,v=>{k.value=[...v]}),N(()=>x.total,v=>{c.value=v});const S=v=>{k.value=k.value.filter(l=>l.id!==v),c.value--};return(v,l)=>{const C=Y("Icon");return d(),m("div",{class:q(["recorded-program-list",{"recorded-program-list--show-sort":!t.hideSort}])},[t.hideHeader?_("",!0):(d(),m("div",so,[e("h2",io,[t.showBackButton?R((d(),m("div",{key:0,class:"recorded-program-list__title-back",onClick:l[0]||(l[0]=f=>v.$router.back())},[a(C,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[j]]):_("",!0),e("span",lo,n(t.title),1),t.showMoreButton?_("",!0):(d(),m("div",no,[t.isSearching?(d(),m(A,{key:0},[a(C,{icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"}),l[6]||(l[6]=e("span",null,"検索中...",-1))],64)):(d(),m(A,{key:1},[u(n(c.value)+"件",1)],64))]))]),e("div",{class:q(["recorded-program-list__actions",{"recorded-program-list__actions--mylist":t.forMylist}])},[t.hideSort?_("",!0):(d(),b(X,{key:0,modelValue:w.value,"onUpdate:modelValue":[l[1]||(l[1]=f=>w.value=f),l[2]||(l[2]=f=>v.$emit("update:sortOrder",f))],items:t.forMylist?[{title:"追加が新しい順",value:"mylist_added_desc"},{title:"追加が古い順",value:"mylist_added_asc"},{title:"録画が新しい順",value:"recorded_desc"},{title:"録画が古い順",value:"recorded_asc"}]:[{title:"新しい順",value:"desc"},{title:"古い順",value:"asc"}],"item-title":"title","item-value":"value",class:"recorded-program-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue","items"])),t.showMoreButton?(d(),b(Q,{key:1,variant:"text",class:"recorded-program-list__more",onClick:l[3]||(l[3]=f=>v.$emit("more"))},{default:r(()=>[l[7]||(l[7]=e("span",{class:"text-primary"},"もっと見る",-1)),a(C,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):_("",!0)],2)])),e("div",{class:q(["recorded-program-list__grid",{"recorded-program-list__grid--loading":t.isLoading||t.isSearching,"recorded-program-list__grid--empty":c.value===0&&t.showEmptyMessage,"recorded-program-list__grid--searching":t.isSearching}])},[e("div",{class:q(["recorded-program-list__empty",{"recorded-program-list__empty--show":c.value===0&&t.showEmptyMessage&&!t.isSearching}])},[e("div",uo,[a(C,{class:"recorded-program-list__empty-icon",icon:t.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),e("h2",{innerHTML:t.emptyMessage},null,8,mo),t.emptySubMessage?(d(),m("div",{key:0,class:"recorded-program-list__empty-submessage",innerHTML:t.emptySubMessage},null,8,co)):_("",!0)])],2),e("div",go,[(d(!0),m(A,null,Ce(k.value,f=>(d(),b(ro,{key:f.id,program:f,forMylist:t.forMylist,forWatchedHistory:t.forWatchedHistory,onDeleted:S},null,8,["program","forMylist","forWatchedHistory"]))),128))])],2),!t.hidePagination&&c.value>0?(d(),m("div",vo,[a(Pe,{modelValue:s.value,"onUpdate:modelValue":[l[4]||(l[4]=f=>s.value=f),l[5]||(l[5]=f=>v.$emit("update:page",f))],"active-color":"primary",density:"comfortable",length:Math.ceil(c.value/30),"total-visible":H(L).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):_("",!0)],2)}}}),Mo=ee(po,[["__scopeId","data-v-6ade5cfc"]]);export{Mo as R};
