import{d as Y,a0 as R,A as C,z as K,K as z,c as u,F as M,b as t,e as p,a as l,n as b,ai as w,k as f,V as _,h as n,t as c,ar as T,U as H,p as I,M as $,ak as k,l as A,r as S,o,_ as F,g as q}from"./index-DH8apSnK.js";import{C as G}from"./Captures-BaGcX3KZ.js";import{V as E}from"./ssrBoot-CgMVngnI.js";import{V as D}from"./VAvatar-Db3om-SH.js";import{V as J}from"./VDialog-BOWRO8-0.js";import{d as N,V as U,b as O,c as P}from"./VCard-_Df7O8hH.js";const Q={class:"capture-detail-drawer__header"},W={key:1,class:"capture-detail-drawer__content"},X={class:"capture-detail-drawer__property"},Z={class:"capture-detail-drawer__property-value"},ee={key:0,class:"capture-detail-drawer__property"},te={class:"capture-detail-drawer__property-value"},ae={key:1,class:"capture-detail-drawer__property"},se={class:"capture-detail-drawer__property-value"},le={class:"capture-detail-drawer__property"},re={class:"capture-detail-drawer__property-value"},oe={class:"capture-detail-drawer__property"},ie={class:"capture-detail-drawer__property-value-container"},ne={class:"capture-detail-drawer__property-value capture-detail-drawer__property-value--path"},de={class:"capture-detail-drawer__footer"},ue=["src"],pe={key:0,class:"mb-4 text-center"},ce={class:"text-h7 text-text mb-2"},me={class:"warning-banner warning-banner--normal"},_e=Y({__name:"CaptureDetailDrawer",props:{capture:{},modelValue:{type:Boolean}},emits:["update:modelValue","delete"],setup(B,{emit:v}){const d=B,h=v,a=R(),r=C(!1),m=K({get:()=>d.modelValue,set:s=>h("update:modelValue",s)});z(m,s=>{s?document.documentElement.classList.add("v-overlay-scroll-blocked"):r.value===!1&&document.documentElement.classList.remove("v-overlay-scroll-blocked")}),z(r,s=>{s?document.documentElement.classList.add("v-overlay-scroll-blocked"):m.value===!1&&document.documentElement.classList.remove("v-overlay-scroll-blocked")});const i=()=>{m.value=!1},L=async()=>{if(d.capture)try{const s=await fetch(d.capture.url);if(!s.ok)throw new Error("Failed to fetch capture image.");const e=await s.blob();H.downloadBlobData(e,d.capture.name),$.success("キャプチャをダウンロードしました。")}catch(s){console.error("Failed to download capture:",s),$.error("キャプチャのダウンロードに失敗しました。")}},y=C(!1),x=async()=>{d.capture&&(y.value=!0)},j=async()=>{if(!d.capture)return;y.value=!1,await G.deleteCapture(d.capture.name)&&($.success("キャプチャを削除しました。"),h("delete"),i())};return(s,e)=>{const V=S("Icon");return o(),u(M,null,[t("div",{class:b(["capture-detail-drawer__scrim",{"capture-detail-drawer__scrim--visible":m.value}]),onClick:i},null,2),t("div",{class:b(["capture-detail-drawer",{"capture-detail-drawer--visible":m.value,"capture-detail-drawer--bottom-sheet":w(a).smAndDown.value}])},[t("div",Q,[e[7]||(e[7]=t("div",{class:"capture-detail-drawer__title"},"キャプチャ情報",-1)),l(E),l(_,{icon:"",variant:"flat",onClick:i},{default:n(()=>[l(k,{icon:"mdi-close"})]),_:1})]),s.capture&&w(a).smAndDown.value?(o(),f(D,{key:0,src:s.capture.url,"aspect-ratio":"1.7778",class:"capture-detail-drawer__image"},null,8,["src"])):p("",!0),s.capture?(o(),u("div",W,[t("div",X,[e[8]||(e[8]=t("div",{class:"capture-detail-drawer__property-label"},"ファイル名",-1)),t("div",Z,c(s.capture.name),1)]),s.capture.time?(o(),u("div",ee,[e[9]||(e[9]=t("div",{class:"capture-detail-drawer__property-label"},"時間",-1)),t("div",te,c(w(T)(s.capture.time).format("YYYY/MM/DD HH:mm:ss")),1)])):p("",!0),s.capture.program_title?(o(),u("div",ae,[e[10]||(e[10]=t("div",{class:"capture-detail-drawer__property-label"},"番組",-1)),t("div",se,c(s.capture.channel_name)+" - "+c(s.capture.program_title),1)])):p("",!0),t("div",le,[e[11]||(e[11]=t("div",{class:"capture-detail-drawer__property-label"},"サイズ",-1)),t("div",re,c(w(H).formatBytes(s.capture.size)),1)]),t("div",oe,[e[13]||(e[13]=t("div",{class:"capture-detail-drawer__property-label"},"パス",-1)),t("div",ie,[t("div",ne,c(s.capture.path),1),w(a).smAndDown.value?(o(),f(_,{key:0,class:"capture-detail-drawer__fullscreen-button",variant:"tonal",size:"large",onClick:e[0]||(e[0]=g=>r.value=!0)},{default:n(()=>[l(k,{icon:"mdi-fullscreen",class:"mr-1",size:"large"}),e[12]||(e[12]=t("span",null,"全画面表示",-1))]),_:1})):p("",!0)])])])):p("",!0),t("div",de,[w(a).smAndDown.value?p("",!0):(o(),f(_,{key:0,class:"mb-4",block:"",size:"large",variant:"tonal",onClick:e[1]||(e[1]=g=>r.value=!0)},{default:n(()=>[l(k,{icon:"mdi-fullscreen",class:"mr-1",size:"large"}),e[14]||(e[14]=t("span",null,"全画面表示",-1))]),_:1})),l(_,{color:"secondary",block:"",size:"large",onClick:L},{default:n(()=>[l(k,{icon:"mdi-download",class:"mr-2"}),e[15]||(e[15]=t("span",null,"ダウンロード",-1))]),_:1}),l(_,{class:"mt-4",color:"error",block:"",size:"large",onClick:x},{default:n(()=>[l(k,{icon:"mdi-delete",class:"mr-2"}),e[16]||(e[16]=t("span",null,"削除",-1))]),_:1})])],2),r.value&&s.capture?(o(),u("div",{key:0,class:"fullscreen-viewer",onClick:e[4]||(e[4]=I(g=>r.value=!1,["self"]))},[t("img",{src:s.capture.url,class:"fullscreen-viewer__image",onClick:e[2]||(e[2]=I(()=>{},["stop"]))},null,8,ue),l(_,{class:"fullscreen-viewer__close-button",icon:"mdi-close",size:"large",variant:"flat",onClick:e[3]||(e[3]=g=>r.value=!1)})])):p("",!0),l(J,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=g=>y.value=g),"max-width":"715"},{default:n(()=>[l(N,null,{default:n(()=>[l(U,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:n(()=>e[17]||(e[17]=[A(" キャプチャを削除しますか？ ")])),_:1}),s.capture?(o(),u("div",pe,[t("div",ce,c(s.capture.name),1)])):p("",!0),l(O,{class:"pt-2 pb-0"},{default:n(()=>[t("div",me,[l(V,{icon:"fluent:info-16-regular",class:"warning-banner__icon"}),e[18]||(e[18]=t("span",{class:"warning-banner__text warning-banner__text--large"}," この操作は元に戻せません。 ",-1))])]),_:1}),l(P,{class:"pt-4 px-6 pb-6"},{default:n(()=>[l(E),l(_,{color:"text",variant:"text",onClick:e[5]||(e[5]=g=>y.value=!1)},{default:n(()=>[l(V,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),e[19]||(e[19]=t("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),l(_,{class:"px-3",color:"error",variant:"flat",onClick:j},{default:n(()=>[l(V,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),e[20]||(e[20]=t("span",{class:"ml-1"},"削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),ve=F(_e,[["__scopeId","data-v-48a3d089"]]),fe={class:"capture-list"},we={key:0,class:"capture-list__header"},ge={class:"capture-list__title"},ye={class:"capture-list__title-text"},ke={class:"capture-list__title-count"},be={class:"capture-list__actions"},he={class:"capture-list__empty-content"},Ce=["innerHTML"],Ve=["innerHTML"],$e={class:"capture-list__grid-content"},Me={key:0,class:"capture-card__title-text"},De={key:1,class:"capture-card__title-text"},Be={key:2,class:"capture-card__title-time"},Le=Y({__name:"CaptureList",props:{title:{},captures:{},hideHeader:{type:Boolean,default:!1},showRefreshButton:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:image-multiple-24-regular"},emptyMessage:{default:"キャプチャはまだありません。"},emptySubMessage:{default:"視聴画面からキャプチャを撮影できます。"},isLoading:{type:Boolean,default:!1}},emits:["refresh","more","delete"],setup(B){const v=C(!1),d=C(null),h=a=>{var r;v.value&&((r=d.value)==null?void 0:r.name)===a.name?(v.value=!1,d.value=null):(d.value=a,v.value=!0)};return(a,r)=>{const m=S("Icon");return o(),u("div",fe,[a.hideHeader?p("",!0):(o(),u("div",we,[t("h2",ge,[t("span",ye,c(a.title),1),t("div",ke,[a.isLoading?(o(),f(m,{key:0,icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"})):(o(),u(M,{key:1},[A(c(a.captures.length)+"件",1)],64))])]),t("div",be,[a.showRefreshButton?(o(),f(_,{key:0,variant:"text",class:"capture-list__refresh-button mr-2",loading:a.isLoading,disabled:a.isLoading,onClick:r[0]||(r[0]=i=>a.$emit("refresh"))},{default:n(()=>[l(m,{icon:"fluent:arrow-sync-16-regular",width:"20px",height:"20px"}),r[4]||(r[4]=t("span",{class:"ml-1"},"更新",-1))]),_:1},8,["loading","disabled"])):p("",!0),a.showMoreButton?(o(),f(_,{key:1,variant:"text",class:"capture-list__more",onClick:r[1]||(r[1]=i=>a.$emit("more"))},{default:n(()=>[r[5]||(r[5]=t("span",{class:"text-primary"},"もっと見る",-1)),l(m,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):p("",!0)])])),t("div",{class:b(["capture-list__grid",{"capture-list__grid--loading":a.isLoading,"capture-list__grid--empty":a.captures.length===0&&a.showEmptyMessage}])},[t("div",{class:b(["capture-list__empty",{"capture-list__empty--show":a.captures.length===0&&a.showEmptyMessage&&!a.isLoading}])},[t("div",he,[l(m,{class:"capture-list__empty-icon",icon:a.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),t("h2",{innerHTML:a.emptyMessage},null,8,Ce),a.emptySubMessage?(o(),u("div",{key:0,class:"capture-list__empty-submessage",innerHTML:a.emptySubMessage},null,8,Ve)):p("",!0)])],2),t("div",$e,[(o(!0),u(M,null,q(a.captures,i=>(o(),f(N,{key:i.name,class:"capture-card",onClick:L=>h(i)},{default:n(()=>[l(D,{src:i.url,"aspect-ratio":"1.7778",class:"align-end"},{default:n(()=>[l(U,{class:"capture-card__title"},{default:n(()=>[i.program_title?(o(),u("div",Me,c(i.program_title),1)):(o(),u("div",De,c(i.name),1)),i.time?(o(),u("div",Be,c(w(T)(i.time).format("YYYY/MM/DD HH:mm:ss")),1)):p("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1032,["onClick"]))),128))])],2),l(ve,{modelValue:v.value,"onUpdate:modelValue":r[2]||(r[2]=i=>v.value=i),capture:d.value,onDelete:r[3]||(r[3]=i=>a.$emit("delete"))},null,8,["modelValue","capture"]),t("div",{class:b(["capture-list__image-viewer",{"capture-list__image-viewer--visible":v.value}])},[d.value?(o(),f(D,{key:0,src:d.value.url,cover:"",class:"capture-list__image-viewer-image"},null,8,["src"])):p("",!0)],2)])}}}),Ae=F(Le,[["__scopeId","data-v-fb05fd7a"]]);export{Ae as C};
