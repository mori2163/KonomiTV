import{d as j,ag as re,Z as w,B as D,z as Y,aL as ee,w as O,c as _,n as L,b as e,e as V,t as m,a as n,ai as C,P as U,h as R,l as $,r as q,al as se,U as I,M as H,o as d,R as N,_ as J,F as A,g as W,cl as K,x,f as T,i as ne,k as z,V as G}from"./index-DFMcdDwy.js";import{R as X}from"./Reservations-CKLCAydc.js";import{V as te}from"./VSwitch-DK55TY5G.js";import{u as ie}from"./Navigation-CdF6g79N.js";import{V as ae}from"./VSlider-YvmoPA-S.js";import{b as F}from"./VTextField-C4Ng7tTw.js";import{V as oe,a as le}from"./VPagination-B8FIIXEU.js";import{c as Z}from"./VSelect-By8zJhtx.js";import{V as de}from"./VDialog-C6e8srmS.js";import{d as ve,V as ce,b as ue,c as _e}from"./VCard-CaHGuJHQ.js";import{V as ge}from"./ssrBoot-dUW8T9Yj.js";const me={class:"reservation__container"},pe={class:"reservation__controls"},fe={key:0,class:"reservation__priority"},be={class:"reservation__priority-badge"},he={class:"reservation__toggle-label"},ye={key:2,class:"reservation__recording"},we={class:"reservation__content"},Ve={class:"reservation__content-header"},$e=["innerHTML"],ke={class:"reservation__content-status"},Se={class:"reservation__content-meta"},Ce={class:"reservation__content-meta-broadcaster"},Ee=["src"],Pe={class:"reservation__content-meta-broadcaster-name"},Re={class:"reservation__content-meta-time"},De={class:"reservation__content-meta-size-comment"},Me={key:0,class:"reservation__content-meta-comment"},Be={class:"reservation__content-meta-comment-text"},Le={class:"reservation__content-meta-size"},Te={class:"reservation__content-meta-time-pc"},Ue={class:"reservation__content-description-container"},Ie=["innerHTML"],xe={class:"reservation__content-description-size-pc"},Fe=j({__name:"Reservation",props:{reservation:{}},emits:["deleted","click"],setup(v,{emit:E}){const u=v,k=E;re();const f=w("EDCB"),l=w(u.reservation.record_settings.is_enabled),g=w(!1);D(()=>u.reservation.record_settings.is_enabled,r=>{l.value=f.value==="EPGStation"?!0:r}),D(f,r=>{r==="EPGStation"&&(l.value=!0)});const s=r=>{const y=r.target;y.src=`${I.api_base_url}/channels/gr001/logo`},h=r=>{if(r.is_recording_in_progress)return"録画中";switch(r.recording_availability){case"Full":return"録画可能";case"Partial":return"一部のみ録画可能";case"Unavailable":return"チューナー不足";default:return"不明"}},S=r=>{if(r.is_recording_in_progress)return"fluent:record-16-filled";switch(r.recording_availability){case"Full":return"fluent:checkmark-16-filled";case"Partial":return"fluent:warning-16-filled";case"Unavailable":return"fluent:dismiss-circle-16-filled";default:return"fluent:question-circle-16-filled"}},M=r=>{if(r.is_recording_in_progress)return"primary";switch(r.recording_availability){case"Full":return"success";case"Partial":return"warning";case"Unavailable":return"error";default:return"grey"}},B=()=>{k("click",u.reservation)},P=async()=>{if(f.value!=="EDCB"){l.value=!0;return}if(!g.value){g.value=!0;try{const r={...u.reservation.record_settings,is_enabled:l.value};if(await X.updateReservation(u.reservation.id,r)){const p=l.value?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;H.success(p)}else l.value=u.reservation.record_settings.is_enabled}catch(r){console.error("Failed to update reservation:",r),l.value=u.reservation.record_settings.is_enabled}finally{g.value=!1}}},i=r=>{r.stopPropagation()};return Y(async()=>{const r=await ee.fetchServerSettings();r&&(f.value=r.general.recorder)}),(r,y)=>{const p=q("Icon");return O((d(),_("div",{class:L(["reservation",{"reservation--disabled":!l.value}]),onClick:B},[e("div",me,[e("div",pe,[f.value==="EDCB"?(d(),_("div",fe,[e("div",be,m(r.reservation.record_settings.priority),1),y[1]||(y[1]=e("div",{class:"reservation__priority-label"},"優先度",-1))])):V("",!0),r.reservation.is_recording_in_progress?(d(),_("div",ye,y[2]||(y[2]=[e("div",{class:"reservation__recording-icon"},null,-1)]))):(d(),_("div",{key:1,class:L(["reservation__toggle",{"reservation__toggle--disabled":f.value==="EPGStation"}]),onClick:i},[n(te,{modelValue:l.value,"onUpdate:modelValue":[y[0]||(y[0]=a=>l.value=a),P],disabled:f.value==="EPGStation",color:"primary",density:"compact","hide-details":"",onClick:i},null,8,["modelValue","disabled"]),e("div",he,m(l.value?"有効":"無効"),1)],2))]),e("div",we,[e("div",Ve,[e("div",{class:"reservation__content-title",innerHTML:C(U).decorateProgramInfo(r.reservation.program,"title")},null,8,$e),e("div",ke,[n(se,{color:M(r.reservation),size:"small",variant:"tonal"},{default:R(()=>[n(p,{icon:S(r.reservation),width:"12px",height:"12px",class:"mr-1"},null,8,["icon"]),$(" "+m(h(r.reservation)),1)]),_:1},8,["color"])])]),e("div",Se,[e("div",Ce,[e("img",{class:"reservation__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${C(I).api_base_url}/channels/${r.reservation.channel.id}/logo`,onError:s},null,40,Ee),e("span",Pe,"Ch: "+m(r.reservation.channel.channel_number)+" "+m(r.reservation.channel.name),1)]),e("div",Re,m(C(U).getProgramTime(r.reservation.program)),1),e("div",De,[r.reservation.comment?(d(),_("div",Me,[n(p,{icon:"fluent:note-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-comment-icon"}),e("span",Be,m(r.reservation.comment),1)])):V("",!0),e("div",Le,[n(p,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-size-icon"}),$(" 約 "+m(C(I).formatBytes(r.reservation.estimated_recording_file_size,1,!0)),1)])]),e("div",Te,m(C(U).getProgramTime(r.reservation.program)),1)]),e("div",Ue,[e("div",{class:"reservation__content-description",innerHTML:C(U).decorateProgramInfo(r.reservation.program,"description")},null,8,Ie),e("div",xe,[n(p,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-description-size-icon"}),$(" 約 "+m(C(I).formatBytes(r.reservation.estimated_recording_file_size,1,!0)),1)])])])])],2)),[[N]])}}}),He=J(Fe,[["__scopeId","data-v-970f0d90"]]),ze=j({name:"ReservationProgramInfo",props:{reservation:{type:Object,required:!0}},data(){return{Utils:Object.freeze(I),ProgramUtils:Object.freeze(U)}},methods:{onLogoError(v){const E=v.target;E.src=`${I.api_base_url}/channels/gr001/logo`}}}),Ge={class:"program-container"},Oe={class:"program-info"},Ne=["innerHTML"],Ae={class:"program-info__broadcaster"},je=["src"],qe={class:"program-info__broadcaster-container"},Je={class:"d-flex align-center"},Ke={class:"program-info__broadcaster-number"},Ze={class:"program-info__broadcaster-name"},Qe={class:"program-info__broadcaster-time"},We=["innerHTML"],Xe={class:"program-info__genre-container"},Ye={class:"mt-5"},et={class:"program-info__status"},tt={class:"ml-2"},rt={class:"program-info__status"},st={class:"ml-2"},nt={key:0,class:"program-info__status"},it={class:"ml-2"},at={class:"program-detail-container"},ot={class:"program-detail__heading"},lt=["innerHTML"];function dt(v,E,u,k,f,l){const g=q("Icon");return d(),_("div",Ge,[e("section",Oe,[e("h1",{class:"program-info__title",innerHTML:v.ProgramUtils.decorateProgramInfo(v.reservation.program,"title")},null,8,Ne),e("div",Ae,[e("img",{class:"program-info__broadcaster-icon",src:`${v.Utils.api_base_url}/channels/${v.reservation.channel.id}/logo`,onError:E[0]||(E[0]=(...s)=>v.onLogoError&&v.onLogoError(...s))},null,40,je),e("div",qe,[e("div",Je,[e("div",Ke,"Ch: "+m(v.reservation.channel.channel_number),1),e("div",Ze,m(v.reservation.channel.name),1)]),e("div",Qe,m(v.ProgramUtils.getProgramTime(v.reservation.program)),1)])]),e("div",{class:"program-info__description",innerHTML:v.ProgramUtils.decorateProgramInfo(v.reservation.program,"description")},null,8,We),e("div",Xe,[(d(!0),_(A,null,W(v.reservation.program.genres??[],(s,h)=>(d(),_("div",{class:"program-info__genre",key:h},m(s.major)+" / "+m(s.middle),1))),128))]),e("div",Ye,[e("div",et,[n(g,{icon:"fluent:video-16-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",tt,"映像: "+m(v.reservation.program.video_codec)+" / "+m(v.reservation.program.video_resolution),1)]),e("div",rt,[n(g,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",st,"主音声: "+m(v.reservation.program.primary_audio_type)+" "+m(v.reservation.program.primary_audio_sampling_rate||"Unknown")+" / "+m(v.reservation.program.primary_audio_language),1)]),v.reservation.program.secondary_audio_type?(d(),_("div",nt,[n(g,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",it,"副音声: "+m(v.reservation.program.secondary_audio_type)+" "+m(v.reservation.program.secondary_audio_sampling_rate||"Unknown")+" / "+m(v.reservation.program.secondary_audio_language),1)])):V("",!0)])]),e("section",at,[(d(!0),_(A,null,W(v.reservation.program.detail??{},(s,h)=>(d(),_("div",{class:"program-detail",key:h},[e("h2",ot,m(h),1),e("div",{class:"program-detail__text",innerHTML:v.Utils.URLtoLink(s)},null,8,lt)]))),128))])])}const vt=J(ze,[["render",dt],["__scopeId","data-v-2691e98c"]]),ct={class:"reservation-recording-settings"},ut={key:0,class:"recording-warning-banner"},_t={class:"reservation-recording-settings__header"},gt={class:"reservation-recording-settings__slider"},mt={class:"reservation-recording-settings__section"},pt={class:"reservation-recording-settings__section"},ft={class:"reservation-recording-settings__margin-default"},bt={class:"reservation-recording-settings__margin-controls"},ht={class:"reservation-recording-settings__description"},yt=j({__name:"ReservationRecordingSettings",props:{reservation:{},hasChanges:{type:Boolean}},emits:["updateSettings","changesDetected"],setup(v,{emit:E}){const u=v,k=E,f=ie(),l=w("EDCB"),g=()=>{l.value==="EPGStation"&&(s.value.is_enabled=!0,h.value.is_enabled=!0)},s=w(structuredClone(K(u.reservation.record_settings))),h=w(structuredClone(K(u.reservation.record_settings))),S=x({get:()=>s.value.recording_folders.length>0?s.value.recording_folders[0].recording_folder_path:"",set:o=>{B(o,M.value)}}),M=x({get:()=>s.value.recording_folders.length>0&&s.value.recording_folders[0].recording_file_name_template||"",set:o=>{B(S.value,o)}}),B=(o,t)=>{const Q=o.trim()!=="",b=t.trim()!=="";!Q&&!b?s.value.recording_folders=[]:(s.value.recording_folders.length===0&&s.value.recording_folders.push({recording_folder_path:"",recording_file_name_template:null,is_oneseg_separate_recording_folder:!1}),s.value.recording_folders[0].recording_folder_path=o,s.value.recording_folders[0].recording_file_name_template=t||null)},P=w(s.value.recording_start_margin===null&&s.value.recording_end_margin===null),i=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],r=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],y=[{title:"デフォルト設定を使う",value:"Default"},{title:"何もしない",value:"Nothing"},{title:"スタンバイ",value:"Standby"},{title:"スタンバイ(復帰後再起動)",value:"StandbyAndReboot"},{title:"サスペンド",value:"Suspend"},{title:"サスペンド(復帰後再起動)",value:"SuspendAndReboot"},{title:"シャットダウン",value:"Shutdown"}],p=x(()=>JSON.stringify(s.value)!==JSON.stringify(h.value));D(p,o=>{k("changesDetected",o)});const a=()=>{g(),k("updateSettings",s.value)},c=()=>{P.value?(s.value.recording_start_margin=null,s.value.recording_end_margin=null):(s.value.recording_start_margin=10,s.value.recording_end_margin=5),a()};return D(()=>u.reservation,o=>{s.value=structuredClone(K(o.record_settings)),h.value=structuredClone(K(o.record_settings)),g()},{deep:!0}),Y(async()=>{await f.fetchServerVersion();const o=await ee.fetchServerSettings();o&&(l.value=o.general.recorder),g()}),D(l,()=>{g()}),(o,t)=>{const Q=q("Icon");return d(),_("div",ct,[o.reservation.is_recording_in_progress?(d(),_("div",ut,[n(Q,{icon:"fluent:warning-16-filled",class:"recording-warning-banner__icon"}),t[11]||(t[11]=e("span",{class:"recording-warning-banner__text"}," 録画中の録画設定の変更はできません。 ",-1))])):V("",!0),e("div",{class:"reservation-recording-settings__section",style:T(l.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[e("div",_t,[t[12]||(t[12]=e("div",{class:"reservation-recording-settings__label"},"録画予約の有効/無効",-1)),n(te,{disabled:o.reservation.is_recording_in_progress,style:{height:"0","margin-top":"-40px","margin-right":"6px"},modelValue:s.value.is_enabled,"onUpdate:modelValue":[t[0]||(t[0]=b=>s.value.is_enabled=b),a],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),t[13]||(t[13]=e("div",{class:"reservation-recording-settings__description mb-0"},[$(" 予約が無効なときは、この番組の録画動作を行いません。"),e("br"),$(" キーワード自動予約条件により不必要な番組が予約されてしまっているときは、予約を無効にしてみてください。(予約削除ではすぐ再追加されてしまい意味がありません。) ")],-1))],4),e("div",{class:"reservation-recording-settings__section",style:T(l.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[t[14]||(t[14]=e("div",{class:"reservation-recording-settings__label"},"録画予約の優先度",-1)),t[15]||(t[15]=e("div",{class:"reservation-recording-settings__description mb-0"}," 放送時間が重なりチューナーが足りないときは、より優先度が高い予約から優先的に録画します。 ",-1)),e("div",gt,[n(ae,{disabled:o.reservation.is_recording_in_progress,modelValue:s.value.priority,"onUpdate:modelValue":[t[1]||(t[1]=b=>s.value.priority=b),a],min:1,max:5,step:1,color:"primary",density:"compact","show-ticks":"always","thumb-label":"","hide-details":""},null,8,["disabled","modelValue"])])],4),e("div",mt,[t[16]||(t[16]=e("div",{class:"reservation-recording-settings__label"},"録画フォルダのパス",-1)),t[17]||(t[17]=e("div",{class:"reservation-recording-settings__description"}," 空欄にすると、デフォルトの録画フォルダに保存されます。 ",-1)),n(F,{disabled:o.reservation.is_recording_in_progress,modelValue:S.value,"onUpdate:modelValue":[t[2]||(t[2]=b=>S.value=b),a],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:C(f).is_linux_environment?"/mnt/hdd/Records/2025年春アニメ":"E:\\Records\\2025年春アニメ"},null,8,["disabled","modelValue","placeholder"])]),e("div",pt,[t[18]||(t[18]=ne('<div class="reservation-recording-settings__label" data-v-7cdf7324>録画ファイル名テンプレート (マクロ)</div><div class="reservation-recording-settings__description" data-v-7cdf7324> 空欄にすると、デフォルトの録画ファイル名テンプレート (マクロ) が録画ファイル名の変更に利用されます。<br data-v-7cdf7324><div class="mt-1" data-v-7cdf7324><a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_EpgTimer.txt#L929-L1008" target="_blank" data-v-7cdf7324>テンプレート構文の一覧</a> / <a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_Mod.txt#%E3%83%9E%E3%82%AF%E3%83%AD" target="_blank" data-v-7cdf7324>xtne6f 版での追加差分</a></div></div>',2)),n(F,{disabled:o.reservation.is_recording_in_progress,modelValue:M.value,"onUpdate:modelValue":[t[3]||(t[3]=b=>M.value=b),a],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:"$ZtoH(Title)$.ts"},null,8,["disabled","modelValue"])]),e("div",{class:"reservation-recording-settings__section",style:T(l.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[t[20]||(t[20]=e("div",{class:"reservation-recording-settings__label"},"録画マージン (秒)",-1)),t[21]||(t[21]=e("div",{class:"reservation-recording-settings__description"}," 番組開始時刻の何秒前から録画を開始し、番組終了時刻の何秒後に録画を終了するかの設定です。最低でも5秒以上をおすすめします。(0秒だと番組の冒頭/末尾が欠けてしまいます。) ",-1)),e("div",ft,[n(oe,{disabled:o.reservation.is_recording_in_progress,id:"use-default-margin",modelValue:P.value,"onUpdate:modelValue":[t[4]||(t[4]=b=>P.value=b),c],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"]),t[19]||(t[19]=e("label",{class:"reservation-recording-settings__margin-default-text",for:"use-default-margin",style:{"user-select":"none"}}," デフォルト設定を使う ",-1))]),e("div",bt,[n(F,{disabled:o.reservation.is_recording_in_progress||P.value,modelValue:s.value.recording_start_margin,"onUpdate:modelValue":[t[5]||(t[5]=b=>s.value.recording_start_margin=b),a],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組開始",suffix:"秒前",style:{width:"160px"}},null,8,["disabled","modelValue"]),n(F,{disabled:o.reservation.is_recording_in_progress||P.value,modelValue:s.value.recording_end_margin,"onUpdate:modelValue":[t[6]||(t[6]=b=>s.value.recording_end_margin=b),a],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組終了",suffix:"秒後",style:{width:"166px"}},null,8,["disabled","modelValue"])])],4),e("div",{class:"reservation-recording-settings__section",style:T(l.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[t[22]||(t[22]=e("div",{class:"reservation-recording-settings__label"},"字幕データ録画設定",-1)),t[23]||(t[23]=e("div",{class:"reservation-recording-settings__description"},[$(" 字幕データはほとんど録画容量を消費しません。"),e("br"),$(" [録画する] に設定しておくことを強くおすすめします。 ")],-1)),n(Z,{disabled:o.reservation.is_recording_in_progress,modelValue:s.value.caption_recording_mode,"onUpdate:modelValue":[t[7]||(t[7]=b=>s.value.caption_recording_mode=b),a],items:i,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])],4),e("div",{class:"reservation-recording-settings__section",style:T(l.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[t[24]||(t[24]=e("div",{class:"reservation-recording-settings__label"},"データ放送録画設定",-1)),t[25]||(t[25]=e("div",{class:"reservation-recording-settings__description"},[$(" データ放送は30分で 500MB 以上録画容量を消費する上、KonomiTV は録画再生時のデータ放送表示に非対応です。"),e("br"),$(" [録画しない] に設定しておくことを強くおすすめします。 ")],-1)),n(Z,{disabled:o.reservation.is_recording_in_progress,modelValue:s.value.data_broadcasting_recording_mode,"onUpdate:modelValue":[t[8]||(t[8]=b=>s.value.data_broadcasting_recording_mode=b),a],items:r,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])],4),e("div",{class:"reservation-recording-settings__section",style:T(l.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[t[26]||(t[26]=e("div",{class:"reservation-recording-settings__label"},"録画後動作設定",-1)),t[27]||(t[27]=e("div",{class:"reservation-recording-settings__description"}," 通常は [何もしない] のままで大丈夫です。録画後に録画 PC をスリープさせておきたい方のみ設定してください。環境によっては復帰できず以降の録画に失敗することがあります。 ",-1)),n(Z,{disabled:o.reservation.is_recording_in_progress,modelValue:s.value.post_recording_mode,"onUpdate:modelValue":[t[9]||(t[9]=b=>s.value.post_recording_mode=b),a],items:y,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])],4),e("div",{class:"reservation-recording-settings__section",style:T(l.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[t[28]||(t[28]=e("div",{class:"reservation-recording-settings__label"},"録画後実行スクリプトのパス",-1)),e("div",ht," 通常は空欄のままで大丈夫です。録画後に指定の "+m(C(f).is_linux_environment?".sh / .lua":".bat / .ps1 / .lua")+" スクリプトを実行させたい方のみ設定してください。 ",1),n(F,{disabled:o.reservation.is_recording_in_progress,modelValue:s.value.post_recording_bat_file_path,"onUpdate:modelValue":[t[10]||(t[10]=b=>s.value.post_recording_bat_file_path=b),a],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:C(f).is_linux_environment?"/var/local/edcb/transcode.sh":"C:\\DTV\\EDCB\\Transcode.bat"},null,8,["disabled","modelValue","placeholder"])],4)])}}}),wt=J(yt,[["__scopeId","data-v-7cdf7324"]]),Vt={class:"reservation-detail-drawer__header"},$t={class:"reservation-detail-drawer__tabs"},kt={class:"reservation-detail-drawer__content"},St={key:0,class:"reservation-detail-drawer__info"},Ct={key:1,class:"reservation-detail-drawer__settings"},Et={class:"reservation-detail-drawer__footer"},Pt={class:"reservation-detail-drawer__actions"},Rt={key:0,class:"mb-4"},Dt=["innerHTML"],Mt={class:"text-body-2 text-text-darken-1"},Bt={key:1,class:"warning-banner warning-banner--recording"},Lt={key:2,class:"warning-banner warning-banner--normal"},Tt={key:3,class:"warning-banner warning-banner--keyword mt-3"},Ut=j({__name:"ReservationDetailDrawer",props:{reservation:{},modelValue:{type:Boolean}},emits:["update:modelValue","updated","deleted"],setup(v,{emit:E}){const u=v,k=E,f=x({get:()=>u.modelValue,set:a=>k("update:modelValue",a)}),l=w("info"),g=w(!1),s=w(!1),h=w(null),S=w(!1),M=x(()=>{var a;return((a=u.reservation)==null?void 0:a.comment.includes("EPG自動予約"))??!1}),B=x(()=>{var a;return((a=u.reservation)==null?void 0:a.is_recording_in_progress)??!1});D(f,a=>{a?(l.value="info",g.value=!1,document.documentElement.classList.add("v-overlay-scroll-blocked")):document.documentElement.classList.remove("v-overlay-scroll-blocked")});const P=()=>{g.value&&!confirm("変更が保存されていません。ドロワーを閉じますか？")||(f.value=!1)},i=a=>{h.value=a},r=async()=>{if(!g.value||s.value||!h.value||!u.reservation)return;const a=h.value.caption_recording_mode==="Default",c=h.value.data_broadcasting_recording_mode==="Default";if(a!==c){H.warning("字幕データ録画設定・データ放送録画設定を明示的に設定する際は、両方とも「デフォルト設定を使う」以外に設定してください。");return}s.value=!0;try{if(await X.updateReservation(u.reservation.id,h.value)){H.success("録画設定の変更を保存しました。");const t={...u.reservation,record_settings:h.value};k("updated",t),g.value=!1}}catch(o){console.error("Failed to save settings:",o),H.error("録画設定の保存に失敗しました。")}finally{s.value=!1}},y=()=>{S.value=!0},p=async()=>{if(S.value=!1,!!u.reservation)try{await X.deleteReservation(u.reservation.id)&&(H.success("録画予約を削除しました。"),k("deleted",u.reservation.id),f.value=!1)}catch(a){console.error("Failed to delete reservation:",a)}};return(a,c)=>{const o=q("Icon");return d(),_(A,null,[e("div",{class:L(["reservation-detail-drawer__scrim",{"reservation-detail-drawer__scrim--visible":f.value}]),onClick:P},null,2),e("div",{class:L(["reservation-detail-drawer",{"reservation-detail-drawer--visible":f.value}])},[e("div",Vt,[e("div",$t,[O((d(),_("div",{class:L(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":l.value==="info"}]),onClick:c[0]||(c[0]=t=>l.value="info")},[n(o,{icon:"fluent:info-12-regular",width:"20px",height:"20px"}),c[5]||(c[5]=e("span",{class:"reservation-detail-drawer__tab-text"},"番組情報",-1))],2)),[[N]]),O((d(),_("div",{class:L(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":l.value==="settings"}]),onClick:c[1]||(c[1]=t=>l.value="settings")},[n(o,{icon:"material-symbols:settings-video-camera-outline-rounded",width:"20px",height:"20px"}),c[6]||(c[6]=e("span",{class:"reservation-detail-drawer__tab-text"},"録画設定",-1))],2)),[[N]])]),O((d(),_("div",{class:"reservation-detail-drawer__close",onClick:P},[n(o,{icon:"fluent:dismiss-16-filled",width:"22px",height:"22px"})])),[[N]])]),e("div",kt,[l.value==="info"&&a.reservation?(d(),_("div",St,[n(vt,{reservation:a.reservation},null,8,["reservation"])])):V("",!0),l.value==="settings"&&a.reservation?(d(),_("div",Ct,[n(wt,{reservation:a.reservation,"has-changes":g.value,onUpdateSettings:i,onChangesDetected:c[2]||(c[2]=t=>g.value=t)},null,8,["reservation","has-changes"])])):V("",!0)]),e("div",Et,[e("div",Pt,[n(G,{class:"px-3",variant:"text",onClick:y},{default:R(()=>[n(o,{icon:"fluent:delete-16-regular",width:"20px",height:"20px"}),c[7]||(c[7]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1}),l.value==="settings"?(d(),z(G,{key:0,class:"px-3",color:"secondary",variant:"flat",disabled:!g.value,loading:s.value,onClick:r},{default:R(()=>[n(o,{icon:"fluent:save-16-regular",width:"20px",height:"20px"}),c[8]||(c[8]=e("span",{class:"ml-1"},"変更を保存",-1))]),_:1},8,["disabled","loading"])):V("",!0)])])],2),n(de,{modelValue:S.value,"onUpdate:modelValue":c[4]||(c[4]=t=>S.value=t),"max-width":"715"},{default:R(()=>[n(ve,null,{default:R(()=>[n(ce,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:R(()=>c[9]||(c[9]=[$(" 録画予約を削除しますか？ ")])),_:1}),n(ue,{class:"pt-2 pb-0"},{default:R(()=>[a.reservation?(d(),_("div",Rt,[e("div",{class:"text-h6 text-text mb-2",innerHTML:C(U).decorateProgramInfo(a.reservation.program,"title")},null,8,Dt),e("div",Mt,m(C(U).getProgramTime(a.reservation.program)),1)])):V("",!0),B.value&&a.reservation?(d(),_("div",Bt,[n(o,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),c[10]||(c[10]=e("span",{class:"warning-banner__text"},[$(" この番組は現在録画中です。"),e("br"),$(" 予約を削除すると、現在までの録画ファイルは残りますが、残りの期間の録画は中断されます。 ")],-1))])):a.reservation?(d(),_("div",Lt,[n(o,{icon:"fluent:info-16-regular",class:"warning-banner__icon"}),c[11]||(c[11]=e("span",{class:"warning-banner__text"}," 録画予約を削除すると、番組開始時刻までに再度予約を追加しない限り、この番組は録画されません。 ",-1))])):V("",!0),M.value&&a.reservation?(d(),_("div",Tt,[n(o,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),c[12]||(c[12]=e("span",{class:"warning-banner__text"},[$(" この予約はキーワード自動予約で追加されました。削除してもすぐに再追加される可能性があります。"),e("br"),$(" 録画が不要な場合は削除ではなく「無効」にすることをおすすめします。 ")],-1))])):V("",!0)]),_:1}),n(_e,{class:"pt-4 px-6 pb-6"},{default:R(()=>[n(ge),n(G,{color:"text",variant:"text",onClick:c[3]||(c[3]=t=>S.value=!1)},{default:R(()=>[n(o,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),c[13]||(c[13]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),n(G,{class:"px-3",color:"error",variant:"flat",onClick:p},{default:R(()=>[n(o,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),c[14]||(c[14]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),It=J(Ut,[["__scopeId","data-v-1de0c508"]]),xt={key:0,class:"reservation-list__header"},Ft={class:"reservation-list__title"},Ht={class:"reservation-list__title-text"},zt={key:1,class:"reservation-list__title-count"},Gt={class:"reservation-list__actions"},Ot={class:"reservation-list__empty-content"},Nt=["innerHTML"],At=["innerHTML"],jt={class:"reservation-list__grid-content"},qt={key:1,class:"reservation-list__pagination"},Jt=j({__name:"ReservationList",props:{title:{},reservations:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:timer-20-regular"},emptyMessage:{default:"まだ録画予約がありません。"},emptySubMessage:{default:"番組表から録画予約を追加できます。"},isLoading:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more","delete"],setup(v,{emit:E}){const u=v,k=w(u.page),f=w(u.sortOrder),l=w([...u.reservations]),g=w(u.total),s=w(!1),h=w(null);D(()=>u.page,i=>{k.value=i}),D(()=>u.sortOrder,i=>{f.value=i}),D(()=>u.reservations,i=>{l.value=[...i]}),D(()=>u.total,i=>{g.value=i});const S=E,M=i=>{h.value=i,s.value=!0},B=i=>{l.value=l.value.filter(r=>r.id!==i),g.value=Math.max(0,g.value-1),s.value=!1,S("delete",i)},P=i=>{const r=l.value.findIndex(y=>y.id===i.id);r!==-1&&(l.value[r]=i),h.value=i};return(i,r)=>{const y=q("Icon");return d(),_("div",{class:L(["reservation-list",{"reservation-list--show-sort":!i.hideSort}])},[i.hideHeader?V("",!0):(d(),_("div",xt,[e("h2",Ft,[i.showBackButton?O((d(),_("div",{key:0,class:"reservation-list__title-back",onClick:r[0]||(r[0]=p=>i.$router.back())},[n(y,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[N]]):V("",!0),e("span",Ht,m(i.title),1),i.showMoreButton?V("",!0):(d(),_("div",zt,[i.isLoading?(d(),z(y,{key:0,icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"})):(d(),_(A,{key:1},[$(m(g.value)+"件",1)],64))]))]),e("div",Gt,[i.hideSort?V("",!0):(d(),z(Z,{key:0,modelValue:f.value,"onUpdate:modelValue":[r[1]||(r[1]=p=>f.value=p),r[2]||(r[2]=p=>i.$emit("update:sortOrder",p))],items:[{title:"放送が近い順",value:"asc"},{title:"放送が遠い順",value:"desc"}],"item-title":"title","item-value":"value",class:"reservation-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue"])),i.showMoreButton?(d(),z(G,{key:1,variant:"text",class:"reservation-list__more",onClick:r[3]||(r[3]=p=>i.$emit("more"))},{default:R(()=>[r[7]||(r[7]=e("span",{class:"text-primary"},"もっと見る",-1)),n(y,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):V("",!0)])])),e("div",{class:L(["reservation-list__grid",{"reservation-list__grid--loading":i.isLoading,"reservation-list__grid--empty":g.value===0&&i.showEmptyMessage}])},[e("div",{class:L(["reservation-list__empty",{"reservation-list__empty--show":g.value===0&&i.showEmptyMessage&&!i.isLoading}])},[e("div",Ot,[n(y,{class:"reservation-list__empty-icon",icon:i.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),e("h2",{innerHTML:i.emptyMessage},null,8,Nt),i.emptySubMessage?(d(),_("div",{key:0,class:"reservation-list__empty-submessage",innerHTML:i.emptySubMessage},null,8,At)):V("",!0)])],2),e("div",jt,[(d(!0),_(A,null,W(l.value,p=>(d(),z(He,{key:p.id,reservation:p,onDeleted:B,onClick:M},null,8,["reservation"]))),128))])],2),!i.hidePagination&&g.value>0?(d(),_("div",qt,[n(le,{modelValue:k.value,"onUpdate:modelValue":[r[4]||(r[4]=p=>k.value=p),r[5]||(r[5]=p=>i.$emit("update:page",p))],"active-color":"primary",density:"comfortable",length:Math.ceil(g.value/30),"total-visible":C(I).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):V("",!0),n(It,{modelValue:s.value,"onUpdate:modelValue":r[6]||(r[6]=p=>s.value=p),reservation:h.value,onDeleted:B,onUpdated:P},null,8,["modelValue","reservation"])],2)}}}),ir=J(Jt,[["__scopeId","data-v-d5010eb2"]]);export{ir as R};
