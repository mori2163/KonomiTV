import{q as ee,s as te,x as se,y as re,z as T,C as ae,D as ne,as as ie,a as n,B as Q,d as N,ah as oe,A as V,K as D,w as O,c as _,n as P,b as e,t as g,ai as S,P as L,h as M,l as $,r as j,U as I,e as y,M as H,o as l,R as z,_ as q,F as A,g as G,ce as J,J as le,i as de,k as x,V as E}from"./index-fVX7BD25.js";import{R as Z}from"./Reservations-Cay184qH.js";import{V as Y}from"./VSwitch-Nn_6Ef70.js";import{V as ue}from"./VChip-CP2A-6fY.js";import{u as ce}from"./Navigation-C0rLQn-z.js";import{V as ve}from"./VSlider-G0aJWNjf.js";import{u as _e,m as ge,V as W,b as F}from"./VTextField-CRh-5ELm.js";import{m as me,e as X,d as K}from"./VSelect-COdEDpfY.js";import{V as pe}from"./VDialog-Bh551h6k.js";import{d as fe,V as he,b as be,c as ye}from"./VCard-C72PqayN.js";import{V as we}from"./ssrBoot-ohZdLY2y.js";import{V as Ve}from"./VPagination-D5d2GC-D.js";const $e=te({...ge(),...ne(me(),["inline"])},"VCheckbox"),ke=ee()({name:"VCheckbox",inheritAttrs:!1,props:$e(),emits:{"update:modelValue":i=>!0,"update:focused":i=>!0},setup(i,k){let{attrs:u,slots:w}=k;const c=se(i,"modelValue"),{isFocused:r,focus:m,blur:p}=_e(i),f=re(),C=T(()=>i.id||`checkbox-${f}`);return ae(()=>{const[R,B]=ie(u),U=W.filterProps(i),s=X.filterProps(i);return n(W,Q({class:["v-checkbox",i.class]},R,U,{modelValue:c.value,"onUpdate:modelValue":o=>c.value=o,id:C.value,focused:r.value,style:i.style}),{...w,default:o=>{let{id:v,messagesId:h,isDisabled:a,isReadonly:t,isValid:b}=o;return n(X,Q(s,{id:v.value,"aria-describedby":h.value,disabled:a.value,readonly:t.value},B,{error:b.value===!1,modelValue:c.value,"onUpdate:modelValue":d=>c.value=d,onFocus:m,onBlur:p}),w)}})}),{}}}),Ce={class:"reservation__container"},Re={class:"reservation__controls"},Se={class:"reservation__priority"},Me={class:"reservation__priority-badge"},Ue={class:"reservation__toggle-label"},Be={key:1,class:"reservation__recording"},De={class:"reservation__content"},Pe={class:"reservation__content-header"},Le=["innerHTML"],Ie={class:"reservation__content-status"},Te={class:"reservation__content-meta"},xe={class:"reservation__content-meta-broadcaster"},Ee=["src"],Fe={class:"reservation__content-meta-broadcaster-name"},He={class:"reservation__content-meta-time"},Oe={class:"reservation__content-meta-size-comment"},ze={key:0,class:"reservation__content-meta-comment"},Ae={class:"reservation__content-meta-comment-text"},Ne={class:"reservation__content-meta-size"},je={class:"reservation__content-meta-time-pc"},qe={class:"reservation__content-description-container"},Je=["innerHTML"],Ke={class:"reservation__content-description-size-pc"},Ge=N({__name:"Reservation",props:{reservation:{}},emits:["deleted","click"],setup(i,{emit:k}){const u=i,w=k;oe();const c=V(u.reservation.record_settings.is_enabled),r=V(!1);D(()=>u.reservation.record_settings.is_enabled,s=>{c.value=s});const m=s=>{const o=s.target;o.src=`${I.api_base_url}/channels/gr001/logo`},p=s=>{if(s.is_recording_in_progress)return"録画中";switch(s.recording_availability){case"Full":return"録画可能";case"Partial":return"一部のみ録画可能";case"Unavailable":return"チューナー不足";default:return"不明"}},f=s=>{if(s.is_recording_in_progress)return"fluent:record-16-filled";switch(s.recording_availability){case"Full":return"fluent:checkmark-16-filled";case"Partial":return"fluent:warning-16-filled";case"Unavailable":return"fluent:dismiss-circle-16-filled";default:return"fluent:question-circle-16-filled"}},C=s=>{if(s.is_recording_in_progress)return"primary";switch(s.recording_availability){case"Full":return"success";case"Partial":return"warning";case"Unavailable":return"error";default:return"grey"}},R=()=>{w("click",u.reservation)},B=async()=>{if(!r.value){r.value=!0;try{const s={...u.reservation.record_settings,is_enabled:c.value};if(await Z.updateReservation(u.reservation.id,s)){const v=c.value?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;H.success(v)}else c.value=u.reservation.record_settings.is_enabled}catch(s){console.error("Failed to update reservation:",s),c.value=u.reservation.record_settings.is_enabled}finally{r.value=!1}}},U=s=>{s.stopPropagation()};return(s,o)=>{const v=j("Icon");return O((l(),_("div",{class:P(["reservation",{"reservation--disabled":!c.value}]),onClick:R},[e("div",Ce,[e("div",Re,[e("div",Se,[e("div",Me,g(s.reservation.record_settings.priority),1),o[1]||(o[1]=e("div",{class:"reservation__priority-label"},"優先度",-1))]),s.reservation.is_recording_in_progress?(l(),_("div",Be,o[2]||(o[2]=[e("div",{class:"reservation__recording-icon"},null,-1)]))):(l(),_("div",{key:0,class:"reservation__toggle",onClick:U},[n(Y,{modelValue:c.value,"onUpdate:modelValue":[o[0]||(o[0]=h=>c.value=h),B],color:"primary",density:"compact","hide-details":"",onClick:U},null,8,["modelValue"]),e("div",Ue,g(c.value?"有効":"無効"),1)]))]),e("div",De,[e("div",Pe,[e("div",{class:"reservation__content-title",innerHTML:S(L).decorateProgramInfo(s.reservation.program,"title")},null,8,Le),e("div",Ie,[n(ue,{color:C(s.reservation),size:"small",variant:"tonal"},{default:M(()=>[n(v,{icon:f(s.reservation),width:"12px",height:"12px",class:"mr-1"},null,8,["icon"]),$(" "+g(p(s.reservation)),1)]),_:1},8,["color"])])]),e("div",Te,[e("div",xe,[e("img",{class:"reservation__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${S(I).api_base_url}/channels/${s.reservation.channel.id}/logo`,onError:m},null,40,Ee),e("span",Fe,"Ch: "+g(s.reservation.channel.channel_number)+" "+g(s.reservation.channel.name),1)]),e("div",He,g(S(L).getProgramTime(s.reservation.program)),1),e("div",Oe,[s.reservation.comment?(l(),_("div",ze,[n(v,{icon:"fluent:note-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-comment-icon"}),e("span",Ae,g(s.reservation.comment),1)])):y("",!0),e("div",Ne,[n(v,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-size-icon"}),$(" 約 "+g(S(I).formatBytes(s.reservation.estimated_recording_file_size,1,!0)),1)])]),e("div",je,g(S(L).getProgramTime(s.reservation.program)),1)]),e("div",qe,[e("div",{class:"reservation__content-description",innerHTML:S(L).decorateProgramInfo(s.reservation.program,"description")},null,8,Je),e("div",Ke,[n(v,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-description-size-icon"}),$(" 約 "+g(S(I).formatBytes(s.reservation.estimated_recording_file_size,1,!0)),1)])])])])],2)),[[z]])}}}),Ze=q(Ge,[["__scopeId","data-v-01534dd9"]]),Qe=N({name:"ReservationProgramInfo",props:{reservation:{type:Object,required:!0}},data(){return{Utils:Object.freeze(I),ProgramUtils:Object.freeze(L)}},methods:{onLogoError(i){const k=i.target;k.src=`${I.api_base_url}/channels/gr001/logo`}}}),We={class:"program-container"},Xe={class:"program-info"},Ye=["innerHTML"],et={class:"program-info__broadcaster"},tt=["src"],st={class:"program-info__broadcaster-container"},rt={class:"d-flex align-center"},at={class:"program-info__broadcaster-number"},nt={class:"program-info__broadcaster-name"},it={class:"program-info__broadcaster-time"},ot=["innerHTML"],lt={class:"program-info__genre-container"},dt={class:"mt-5"},ut={class:"program-info__status"},ct={class:"ml-2"},vt={class:"program-info__status"},_t={class:"ml-2"},gt={key:0,class:"program-info__status"},mt={class:"ml-2"},pt={class:"program-detail-container"},ft={class:"program-detail__heading"},ht=["innerHTML"];function bt(i,k,u,w,c,r){const m=j("Icon");return l(),_("div",We,[e("section",Xe,[e("h1",{class:"program-info__title",innerHTML:i.ProgramUtils.decorateProgramInfo(i.reservation.program,"title")},null,8,Ye),e("div",et,[e("img",{class:"program-info__broadcaster-icon",src:`${i.Utils.api_base_url}/channels/${i.reservation.channel.id}/logo`,onError:k[0]||(k[0]=(...p)=>i.onLogoError&&i.onLogoError(...p))},null,40,tt),e("div",st,[e("div",rt,[e("div",at,"Ch: "+g(i.reservation.channel.channel_number),1),e("div",nt,g(i.reservation.channel.name),1)]),e("div",it,g(i.ProgramUtils.getProgramTime(i.reservation.program)),1)])]),e("div",{class:"program-info__description",innerHTML:i.ProgramUtils.decorateProgramInfo(i.reservation.program,"description")},null,8,ot),e("div",lt,[(l(!0),_(A,null,G(i.reservation.program.genres??[],(p,f)=>(l(),_("div",{class:"program-info__genre",key:f},g(p.major)+" / "+g(p.middle),1))),128))]),e("div",dt,[e("div",ut,[n(m,{icon:"fluent:video-16-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",ct,"映像: "+g(i.reservation.program.video_codec)+" / "+g(i.reservation.program.video_resolution),1)]),e("div",vt,[n(m,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",_t,"主音声: "+g(i.reservation.program.primary_audio_type)+" "+g(i.reservation.program.primary_audio_sampling_rate||"Unknown")+" / "+g(i.reservation.program.primary_audio_language),1)]),i.reservation.program.secondary_audio_type?(l(),_("div",gt,[n(m,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",mt,"副音声: "+g(i.reservation.program.secondary_audio_type)+" "+g(i.reservation.program.secondary_audio_sampling_rate||"Unknown")+" / "+g(i.reservation.program.secondary_audio_language),1)])):y("",!0)])]),e("section",pt,[(l(!0),_(A,null,G(i.reservation.program.detail??{},(p,f)=>(l(),_("div",{class:"program-detail",key:f},[e("h2",ft,g(f),1),e("div",{class:"program-detail__text",innerHTML:i.Utils.URLtoLink(p)},null,8,ht)]))),128))])])}const yt=q(Qe,[["render",bt],["__scopeId","data-v-2691e98c"]]),wt={class:"reservation-recording-settings"},Vt={key:0,class:"recording-warning-banner"},$t={class:"reservation-recording-settings__section"},kt={class:"reservation-recording-settings__header"},Ct={class:"reservation-recording-settings__section"},Rt={class:"reservation-recording-settings__slider"},St={class:"reservation-recording-settings__section"},Mt={class:"reservation-recording-settings__section"},Ut={class:"reservation-recording-settings__section"},Bt={class:"reservation-recording-settings__margin-default"},Dt={class:"reservation-recording-settings__margin-controls"},Pt={class:"reservation-recording-settings__section"},Lt={class:"reservation-recording-settings__section"},It={class:"reservation-recording-settings__section"},Tt={class:"reservation-recording-settings__section"},xt={class:"reservation-recording-settings__description"},Et=N({__name:"ReservationRecordingSettings",props:{reservation:{},hasChanges:{type:Boolean}},emits:["updateSettings","changesDetected"],setup(i,{emit:k}){const u=i,w=k,c=ce(),r=V(structuredClone(J(u.reservation.record_settings))),m=V(structuredClone(J(u.reservation.record_settings))),p=T({get:()=>r.value.recording_folders.length>0?r.value.recording_folders[0].recording_folder_path:"",set:a=>{C(a,f.value)}}),f=T({get:()=>r.value.recording_folders.length>0&&r.value.recording_folders[0].recording_file_name_template||"",set:a=>{C(p.value,a)}}),C=(a,t)=>{const b=a.trim()!=="",d=t.trim()!=="";!b&&!d?r.value.recording_folders=[]:(r.value.recording_folders.length===0&&r.value.recording_folders.push({recording_folder_path:"",recording_file_name_template:null,is_oneseg_separate_recording_folder:!1}),r.value.recording_folders[0].recording_folder_path=a,r.value.recording_folders[0].recording_file_name_template=t||null)},R=V(r.value.recording_start_margin===null&&r.value.recording_end_margin===null),B=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],U=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],s=[{title:"デフォルト設定を使う",value:"Default"},{title:"何もしない",value:"Nothing"},{title:"スタンバイ",value:"Standby"},{title:"スタンバイ(復帰後再起動)",value:"StandbyAndReboot"},{title:"サスペンド",value:"Suspend"},{title:"サスペンド(復帰後再起動)",value:"SuspendAndReboot"},{title:"シャットダウン",value:"Shutdown"}],o=T(()=>JSON.stringify(r.value)!==JSON.stringify(m.value));D(o,a=>{w("changesDetected",a)});const v=()=>{w("updateSettings",r.value)},h=()=>{R.value?(r.value.recording_start_margin=null,r.value.recording_end_margin=null):(r.value.recording_start_margin=10,r.value.recording_end_margin=5),v()};return D(()=>u.reservation,a=>{r.value=structuredClone(J(a.record_settings)),m.value=structuredClone(J(a.record_settings))},{deep:!0}),le(async()=>{await c.fetchServerVersion()}),(a,t)=>{const b=j("Icon");return l(),_("div",wt,[a.reservation.is_recording_in_progress?(l(),_("div",Vt,[n(b,{icon:"fluent:warning-16-filled",class:"recording-warning-banner__icon"}),t[11]||(t[11]=e("span",{class:"recording-warning-banner__text"}," 録画中の録画設定の変更はできません。 ",-1))])):y("",!0),e("div",$t,[e("div",kt,[t[12]||(t[12]=e("div",{class:"reservation-recording-settings__label"},"録画予約の有効/無効",-1)),n(Y,{disabled:a.reservation.is_recording_in_progress,style:{height:"0","margin-top":"-40px","margin-right":"6px"},modelValue:r.value.is_enabled,"onUpdate:modelValue":[t[0]||(t[0]=d=>r.value.is_enabled=d),v],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),t[13]||(t[13]=e("div",{class:"reservation-recording-settings__description mb-0"},[$(" 予約が無効なときは、この番組の録画動作を行いません。"),e("br"),$(" キーワード自動予約条件により不必要な番組が予約されてしまっているときは、予約を無効にしてみてください。(予約削除ではすぐ再追加されてしまい意味がありません。) ")],-1))]),e("div",Ct,[t[14]||(t[14]=e("div",{class:"reservation-recording-settings__label"},"録画予約の優先度",-1)),t[15]||(t[15]=e("div",{class:"reservation-recording-settings__description mb-0"}," 放送時間が重なりチューナーが足りないときは、より優先度が高い予約から優先的に録画します。 ",-1)),e("div",Rt,[n(ve,{disabled:a.reservation.is_recording_in_progress,modelValue:r.value.priority,"onUpdate:modelValue":[t[1]||(t[1]=d=>r.value.priority=d),v],min:1,max:5,step:1,color:"primary",density:"compact","show-ticks":"always","thumb-label":"","hide-details":""},null,8,["disabled","modelValue"])])]),e("div",St,[t[16]||(t[16]=e("div",{class:"reservation-recording-settings__label"},"録画フォルダのパス",-1)),t[17]||(t[17]=e("div",{class:"reservation-recording-settings__description"}," 空欄にすると、デフォルトの録画フォルダに保存されます。 ",-1)),n(F,{disabled:a.reservation.is_recording_in_progress,modelValue:p.value,"onUpdate:modelValue":[t[2]||(t[2]=d=>p.value=d),v],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:S(c).is_linux_environment?"/mnt/hdd/Records/2025年春アニメ":"E:\\Records\\2025年春アニメ"},null,8,["disabled","modelValue","placeholder"])]),e("div",Mt,[t[18]||(t[18]=de('<div class="reservation-recording-settings__label" data-v-28abe1e8>録画ファイル名テンプレート (マクロ)</div><div class="reservation-recording-settings__description" data-v-28abe1e8> 空欄にすると、デフォルトの録画ファイル名テンプレート (マクロ) が録画ファイル名の変更に利用されます。<br data-v-28abe1e8><div class="mt-1" data-v-28abe1e8><a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_EpgTimer.txt#L929-L1008" target="_blank" data-v-28abe1e8>テンプレート構文の一覧</a> / <a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_Mod.txt#%E3%83%9E%E3%82%AF%E3%83%AD" target="_blank" data-v-28abe1e8>xtne6f 版での追加差分</a></div></div>',2)),n(F,{disabled:a.reservation.is_recording_in_progress,modelValue:f.value,"onUpdate:modelValue":[t[3]||(t[3]=d=>f.value=d),v],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:"$ZtoH(Title)$.ts"},null,8,["disabled","modelValue"])]),e("div",Ut,[t[20]||(t[20]=e("div",{class:"reservation-recording-settings__label"},"録画マージン (秒)",-1)),t[21]||(t[21]=e("div",{class:"reservation-recording-settings__description"}," 番組開始時刻の何秒前から録画を開始し、番組終了時刻の何秒後に録画を終了するかの設定です。最低でも5秒以上をおすすめします。(0秒だと番組の冒頭/末尾が欠けてしまいます。) ",-1)),e("div",Bt,[n(ke,{disabled:a.reservation.is_recording_in_progress,id:"use-default-margin",modelValue:R.value,"onUpdate:modelValue":[t[4]||(t[4]=d=>R.value=d),h],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"]),t[19]||(t[19]=e("label",{class:"reservation-recording-settings__margin-default-text",for:"use-default-margin",style:{"user-select":"none"}}," デフォルト設定を使う ",-1))]),e("div",Dt,[n(F,{disabled:a.reservation.is_recording_in_progress||R.value,modelValue:r.value.recording_start_margin,"onUpdate:modelValue":[t[5]||(t[5]=d=>r.value.recording_start_margin=d),v],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組開始",suffix:"秒前",style:{width:"160px"}},null,8,["disabled","modelValue"]),n(F,{disabled:a.reservation.is_recording_in_progress||R.value,modelValue:r.value.recording_end_margin,"onUpdate:modelValue":[t[6]||(t[6]=d=>r.value.recording_end_margin=d),v],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組終了",suffix:"秒後",style:{width:"166px"}},null,8,["disabled","modelValue"])])]),e("div",Pt,[t[22]||(t[22]=e("div",{class:"reservation-recording-settings__label"},"字幕データ録画設定",-1)),t[23]||(t[23]=e("div",{class:"reservation-recording-settings__description"},[$(" 字幕データはほとんど録画容量を消費しません。"),e("br"),$(" [録画する] に設定しておくことを強くおすすめします。 ")],-1)),n(K,{disabled:a.reservation.is_recording_in_progress,modelValue:r.value.caption_recording_mode,"onUpdate:modelValue":[t[7]||(t[7]=d=>r.value.caption_recording_mode=d),v],items:B,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",Lt,[t[24]||(t[24]=e("div",{class:"reservation-recording-settings__label"},"データ放送録画設定",-1)),t[25]||(t[25]=e("div",{class:"reservation-recording-settings__description"},[$(" データ放送は30分で 500MB 以上録画容量を消費する上、KonomiTV は録画再生時のデータ放送表示に非対応です。"),e("br"),$(" [録画しない] に設定しておくことを強くおすすめします。 ")],-1)),n(K,{disabled:a.reservation.is_recording_in_progress,modelValue:r.value.data_broadcasting_recording_mode,"onUpdate:modelValue":[t[8]||(t[8]=d=>r.value.data_broadcasting_recording_mode=d),v],items:U,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",It,[t[26]||(t[26]=e("div",{class:"reservation-recording-settings__label"},"録画後動作設定",-1)),t[27]||(t[27]=e("div",{class:"reservation-recording-settings__description"}," 通常は [何もしない] のままで大丈夫です。録画後に録画 PC をスリープさせておきたい方のみ設定してください。環境によっては復帰できず以降の録画に失敗することがあります。 ",-1)),n(K,{disabled:a.reservation.is_recording_in_progress,modelValue:r.value.post_recording_mode,"onUpdate:modelValue":[t[9]||(t[9]=d=>r.value.post_recording_mode=d),v],items:s,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",Tt,[t[28]||(t[28]=e("div",{class:"reservation-recording-settings__label"},"録画後実行スクリプトのパス",-1)),e("div",xt," 通常は空欄のままで大丈夫です。録画後に指定の "+g(S(c).is_linux_environment?".sh / .lua":".bat / .ps1 / .lua")+" スクリプトを実行させたい方のみ設定してください。 ",1),n(F,{disabled:a.reservation.is_recording_in_progress,modelValue:r.value.post_recording_bat_file_path,"onUpdate:modelValue":[t[10]||(t[10]=d=>r.value.post_recording_bat_file_path=d),v],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:S(c).is_linux_environment?"/var/local/edcb/transcode.sh":"C:\\DTV\\EDCB\\Transcode.bat"},null,8,["disabled","modelValue","placeholder"])])])}}}),Ft=q(Et,[["__scopeId","data-v-28abe1e8"]]),Ht={class:"reservation-detail-drawer__header"},Ot={class:"reservation-detail-drawer__tabs"},zt={class:"reservation-detail-drawer__content"},At={key:0,class:"reservation-detail-drawer__info"},Nt={key:1,class:"reservation-detail-drawer__settings"},jt={class:"reservation-detail-drawer__footer"},qt={class:"reservation-detail-drawer__actions"},Jt={key:0,class:"mb-4"},Kt=["innerHTML"],Gt={class:"text-body-2 text-text-darken-1"},Zt={key:1,class:"warning-banner warning-banner--recording"},Qt={key:2,class:"warning-banner warning-banner--normal"},Wt={key:3,class:"warning-banner warning-banner--keyword mt-3"},Xt=N({__name:"ReservationDetailDrawer",props:{reservation:{},modelValue:{type:Boolean}},emits:["update:modelValue","updated","deleted"],setup(i,{emit:k}){const u=i,w=k,c=T({get:()=>u.modelValue,set:a=>w("update:modelValue",a)}),r=V("info"),m=V(!1),p=V(!1),f=V(null),C=V(!1),R=T(()=>{var a;return((a=u.reservation)==null?void 0:a.comment.includes("EPG自動予約"))??!1}),B=T(()=>{var a;return((a=u.reservation)==null?void 0:a.is_recording_in_progress)??!1});D(c,a=>{a?(r.value="info",m.value=!1,document.documentElement.classList.add("v-overlay-scroll-blocked")):document.documentElement.classList.remove("v-overlay-scroll-blocked")});const U=()=>{m.value&&!confirm("変更が保存されていません。ドロワーを閉じますか？")||(c.value=!1)},s=a=>{f.value=a},o=async()=>{if(!m.value||p.value||!f.value||!u.reservation)return;const a=f.value.caption_recording_mode==="Default",t=f.value.data_broadcasting_recording_mode==="Default";if(a!==t){H.warning("字幕データ録画設定・データ放送録画設定を明示的に設定する際は、両方とも「デフォルト設定を使う」以外に設定してください。");return}p.value=!0;try{if(await Z.updateReservation(u.reservation.id,f.value)){H.success("録画設定の変更を保存しました。");const d={...u.reservation,record_settings:f.value};w("updated",d),m.value=!1}}catch(b){console.error("Failed to save settings:",b),H.error("録画設定の保存に失敗しました。")}finally{p.value=!1}},v=()=>{C.value=!0},h=async()=>{if(C.value=!1,!!u.reservation)try{await Z.deleteReservation(u.reservation.id)&&(H.success("録画予約を削除しました。"),w("deleted",u.reservation.id),c.value=!1)}catch(a){console.error("Failed to delete reservation:",a)}};return(a,t)=>{const b=j("Icon");return l(),_(A,null,[e("div",{class:P(["reservation-detail-drawer__scrim",{"reservation-detail-drawer__scrim--visible":c.value}]),onClick:U},null,2),e("div",{class:P(["reservation-detail-drawer",{"reservation-detail-drawer--visible":c.value}])},[e("div",Ht,[e("div",Ot,[O((l(),_("div",{class:P(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":r.value==="info"}]),onClick:t[0]||(t[0]=d=>r.value="info")},[n(b,{icon:"fluent:info-12-regular",width:"20px",height:"20px"}),t[5]||(t[5]=e("span",{class:"reservation-detail-drawer__tab-text"},"番組情報",-1))],2)),[[z]]),O((l(),_("div",{class:P(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":r.value==="settings"}]),onClick:t[1]||(t[1]=d=>r.value="settings")},[n(b,{icon:"material-symbols:settings-video-camera-outline-rounded",width:"20px",height:"20px"}),t[6]||(t[6]=e("span",{class:"reservation-detail-drawer__tab-text"},"録画設定",-1))],2)),[[z]])]),O((l(),_("div",{class:"reservation-detail-drawer__close",onClick:U},[n(b,{icon:"fluent:dismiss-16-filled",width:"22px",height:"22px"})])),[[z]])]),e("div",zt,[r.value==="info"&&a.reservation?(l(),_("div",At,[n(yt,{reservation:a.reservation},null,8,["reservation"])])):y("",!0),r.value==="settings"&&a.reservation?(l(),_("div",Nt,[n(Ft,{reservation:a.reservation,"has-changes":m.value,onUpdateSettings:s,onChangesDetected:t[2]||(t[2]=d=>m.value=d)},null,8,["reservation","has-changes"])])):y("",!0)]),e("div",jt,[e("div",qt,[n(E,{class:"px-3",variant:"text",onClick:v},{default:M(()=>[n(b,{icon:"fluent:delete-16-regular",width:"20px",height:"20px"}),t[7]||(t[7]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1}),r.value==="settings"?(l(),x(E,{key:0,class:"px-3",color:"secondary",variant:"flat",disabled:!m.value,loading:p.value,onClick:o},{default:M(()=>[n(b,{icon:"fluent:save-16-regular",width:"20px",height:"20px"}),t[8]||(t[8]=e("span",{class:"ml-1"},"変更を保存",-1))]),_:1},8,["disabled","loading"])):y("",!0)])])],2),n(pe,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=d=>C.value=d),"max-width":"715"},{default:M(()=>[n(fe,null,{default:M(()=>[n(he,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:M(()=>t[9]||(t[9]=[$(" 録画予約を削除しますか？ ")])),_:1}),n(be,{class:"pt-2 pb-0"},{default:M(()=>[a.reservation?(l(),_("div",Jt,[e("div",{class:"text-h6 text-text mb-2",innerHTML:S(L).decorateProgramInfo(a.reservation.program,"title")},null,8,Kt),e("div",Gt,g(S(L).getProgramTime(a.reservation.program)),1)])):y("",!0),B.value&&a.reservation?(l(),_("div",Zt,[n(b,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),t[10]||(t[10]=e("span",{class:"warning-banner__text"},[$(" この番組は現在録画中です。"),e("br"),$(" 予約を削除すると、現在までの録画ファイルは残りますが、残りの期間の録画は中断されます。 ")],-1))])):a.reservation?(l(),_("div",Qt,[n(b,{icon:"fluent:info-16-regular",class:"warning-banner__icon"}),t[11]||(t[11]=e("span",{class:"warning-banner__text"}," 録画予約を削除すると、番組開始時刻までに再度予約を追加しない限り、この番組は録画されません。 ",-1))])):y("",!0),R.value&&a.reservation?(l(),_("div",Wt,[n(b,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),t[12]||(t[12]=e("span",{class:"warning-banner__text"},[$(" この予約はキーワード自動予約で追加されました。削除してもすぐに再追加される可能性があります。"),e("br"),$(" 録画が不要な場合は削除ではなく「無効」にすることをおすすめします。 ")],-1))])):y("",!0)]),_:1}),n(ye,{class:"pt-4 px-6 pb-6"},{default:M(()=>[n(we),n(E,{color:"text",variant:"text",onClick:t[3]||(t[3]=d=>C.value=!1)},{default:M(()=>[n(b,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),t[13]||(t[13]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),n(E,{class:"px-3",color:"error",variant:"flat",onClick:h},{default:M(()=>[n(b,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),t[14]||(t[14]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Yt=q(Xt,[["__scopeId","data-v-1de0c508"]]),es={key:0,class:"reservation-list__header"},ts={class:"reservation-list__title"},ss={class:"reservation-list__title-text"},rs={key:1,class:"reservation-list__title-count"},as={class:"reservation-list__actions"},ns={class:"reservation-list__empty-content"},is=["innerHTML"],os=["innerHTML"],ls={class:"reservation-list__grid-content"},ds={key:1,class:"reservation-list__pagination"},us=N({__name:"ReservationList",props:{title:{},reservations:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showRefreshButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:timer-20-regular"},emptyMessage:{default:"まだ録画予約がありません。"},emptySubMessage:{default:"番組表から録画予約を追加できます。"},isLoading:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more","refresh","delete"],setup(i,{emit:k}){const u=i,w=V(u.page),c=V(u.sortOrder),r=V([...u.reservations]),m=V(u.total),p=V(!1),f=V(null);D(()=>u.page,s=>{w.value=s}),D(()=>u.sortOrder,s=>{c.value=s}),D(()=>u.reservations,s=>{r.value=[...s]}),D(()=>u.total,s=>{m.value=s});const C=k,R=s=>{f.value=s,p.value=!0},B=s=>{r.value=r.value.filter(o=>o.id!==s),m.value=Math.max(0,m.value-1),p.value=!1,C("delete",s)},U=s=>{const o=r.value.findIndex(v=>v.id===s.id);o!==-1&&(r.value[o]=s),f.value=s};return(s,o)=>{const v=j("Icon");return l(),_("div",{class:P(["reservation-list",{"reservation-list--show-sort":!s.hideSort}])},[s.hideHeader?y("",!0):(l(),_("div",es,[e("h2",ts,[s.showBackButton?O((l(),_("div",{key:0,class:"reservation-list__title-back",onClick:o[0]||(o[0]=h=>s.$router.back())},[n(v,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[z]]):y("",!0),e("span",ss,g(s.title),1),s.showMoreButton?y("",!0):(l(),_("div",rs,[s.isLoading?(l(),x(v,{key:0,icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"})):(l(),_(A,{key:1},[$(g(m.value)+"件",1)],64))]))]),e("div",as,[s.hideSort?y("",!0):(l(),x(K,{key:0,modelValue:c.value,"onUpdate:modelValue":[o[1]||(o[1]=h=>c.value=h),o[2]||(o[2]=h=>s.$emit("update:sortOrder",h))],items:[{title:"放送が近い順",value:"asc"},{title:"放送が遠い順",value:"desc"}],"item-title":"title","item-value":"value",class:"reservation-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue"])),s.showRefreshButton?(l(),x(E,{key:1,variant:"text",class:"reservation-list__refresh-button mr-2",loading:s.isLoading,disabled:s.isLoading,onClick:o[3]||(o[3]=h=>s.$emit("refresh"))},{default:M(()=>[n(v,{icon:"fluent:arrow-sync-16-regular",width:"20px",height:"20px"}),o[8]||(o[8]=e("span",{class:"ml-1"},"更新",-1))]),_:1},8,["loading","disabled"])):y("",!0),s.showMoreButton?(l(),x(E,{key:2,variant:"text",class:"reservation-list__more",onClick:o[4]||(o[4]=h=>s.$emit("more"))},{default:M(()=>[o[9]||(o[9]=e("span",{class:"text-primary"},"もっと見る",-1)),n(v,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):y("",!0)])])),e("div",{class:P(["reservation-list__grid",{"reservation-list__grid--loading":s.isLoading,"reservation-list__grid--empty":m.value===0&&s.showEmptyMessage}])},[e("div",{class:P(["reservation-list__empty",{"reservation-list__empty--show":m.value===0&&s.showEmptyMessage&&!s.isLoading}])},[e("div",ns,[n(v,{class:"reservation-list__empty-icon",icon:s.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),e("h2",{innerHTML:s.emptyMessage},null,8,is),s.emptySubMessage?(l(),_("div",{key:0,class:"reservation-list__empty-submessage",innerHTML:s.emptySubMessage},null,8,os)):y("",!0)])],2),e("div",ls,[(l(!0),_(A,null,G(r.value,h=>(l(),x(Ze,{key:h.id,reservation:h,onDeleted:B,onClick:R},null,8,["reservation"]))),128))])],2),!s.hidePagination&&m.value>0?(l(),_("div",ds,[n(Ve,{modelValue:w.value,"onUpdate:modelValue":[o[5]||(o[5]=h=>w.value=h),o[6]||(o[6]=h=>s.$emit("update:page",h))],"active-color":"primary",density:"comfortable",length:Math.ceil(m.value/30),"total-visible":S(I).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):y("",!0),n(Yt,{modelValue:p.value,"onUpdate:modelValue":o[7]||(o[7]=h=>p.value=h),reservation:f.value,onDeleted:B,onUpdated:U},null,8,["modelValue","reservation"])],2)}}}),$s=q(us,[["__scopeId","data-v-3ba1e77d"]]);export{$s as R};
