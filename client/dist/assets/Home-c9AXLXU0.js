import{B as E}from"./Breadcrumbs-CCZLkOGa.js";import{H as R,N as L}from"./Navigation-CwpYL5Cb.js";import{S as V}from"./SPHeaderBar-BCKRUExu.js";import{R as g}from"./RecordedProgramList-CtbpmgHJ.js";import{V as h}from"./Videos-Cl1izIFp.js";import{d as H,A as a,u as I,K as M,J as A,al as $,c as N,a as r,b as v,n as U,o as k,_ as C}from"./index-DH8apSnK.js";import"./ssrBoot-CgMVngnI.js";import"./VDialog-BOWRO8-0.js";import"./VOverlay-CTzZUyW5.js";import"./forwardRefs-B931MWyl.js";import"./transition-DB5taBrl.js";import"./dialog-transition-CFq2Azvt.js";import"./VCard-_Df7O8hH.js";import"./VAvatar-Db3om-SH.js";import"./VSelect-Ezksbuv-.js";import"./VTextField-BdO2Gmxx.js";import"./index-DJgUtcrO.js";import"./VDivider-lJ_zDGAW.js";import"./VSelectionControl-DmKDQMDw.js";import"./VChip-CzSyRcIe.js";import"./VPagination-jc-agtRN.js";const F={class:"route-container"},O={class:"videos-home-container-wrapper"},T={class:"videos-home-container"},W=30*1e3,j=H({__name:"Home",setup(z){const l=a([]),_=a(0),m=a([]),u=a(0),c=a([]),d=a(0),o=a(!0),i=a(null),n=I();M(()=>n.settings.mylist,async()=>{await y()},{deep:!0}),M(()=>n.settings.watched_history,async()=>{await f()},{deep:!0});const P=async()=>{const e=await h.fetchVideos("desc",1);e&&(l.value=e.recorded_programs.slice(0,10),_.value=e.total)},y=async()=>{const e=n.settings.mylist.filter(s=>s.type==="RecordedProgram").sort((s,p)=>p.created_at-s.created_at).map(s=>s.id);if(e.length===0){m.value=[],u.value=0;return}const t=await h.fetchVideos("ids",1,e);t&&(m.value=t.recorded_programs.slice(0,4),u.value=t.total)},f=async()=>{const e=n.settings.watched_history.sort((s,p)=>p.updated_at-s.updated_at).map(s=>s.video_id);if(e.length===0){c.value=[],d.value=0;return}const t=await h.fetchVideos("ids",1,e);t&&(c.value=t.recorded_programs.slice(0,4),d.value=t.total)},S={recentPrograms:P,mylistPrograms:y,watchedPrograms:f},w=async()=>{try{await Promise.all(Object.values(S).map(e=>e())),o.value=!1}catch(e){console.error("Failed to update sections:",e),o.value=!1}},b=()=>{i.value===null&&(w(),i.value=window.setInterval(w,W))},B=()=>{i.value!==null&&(clearInterval(i.value),i.value=null)};return A(()=>{b()}),$(()=>{B()}),(e,t)=>(k(),N("div",F,[r(R),v("main",null,[r(L),v("div",O,[r(V),v("div",T,[r(E,{crumbs:[{name:"ホーム",path:"/"},{name:"ビデオをみる",path:"/videos/",disabled:!0}]}),r(g,{class:U(["videos-home-container__recent-programs",{"videos-home-container__recent-programs--loading":l.value.length===0&&o.value}]),title:"新着の録画番組",programs:l.value,total:_.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showSearch:!0,isLoading:o.value,showEmptyMessage:!o.value,onMore:t[0]||(t[0]=s=>e.$router.push("/videos/programs"))},null,8,["class","programs","total","isLoading","showEmptyMessage"]),r(g,{title:"マイリスト",programs:m.value,total:u.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showEmptyMessage:!o.value,emptyIcon:"ic:round-playlist-play",emptyMessage:"あとで見たい番組を<br class='d-sm-none'>マイリストに保存できます。",emptySubMessage:"録画番組の右上にある ＋ ボタンから、<br class='d-sm-none'>番組をマイリストに追加できます。",isLoading:o.value,forMylist:!0,onMore:t[1]||(t[1]=s=>e.$router.push("/mylist/"))},null,8,["programs","total","showEmptyMessage","isLoading"]),r(g,{title:"視聴履歴",programs:c.value,total:d.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showEmptyMessage:!o.value,emptyIcon:"fluent:history-20-regular",emptyMessage:"まだ視聴履歴がありません。",emptySubMessage:"録画番組を30秒以上みると、<br class='d-sm-none'>視聴履歴に追加されます。",isLoading:o.value,forWatchedHistory:!0,onMore:t[2]||(t[2]=s=>e.$router.push("/watched-history/"))},null,8,["programs","total","showEmptyMessage","isLoading"])])])])]))}}),ce=C(j,[["__scopeId","data-v-c5e8064f"]]);export{ce as default};
