import{d as X,k as w,h as t,a as r,b as e,w as P,r as G,c as g,e as h,t as p,ai as H,U as I,P as W,ap as be,F as U,o as l,R as N,_ as ee,x as D,Z as B,B as Y,z as we,l as m,aI as me,aJ as ge,al as Q,ab as fe,aK as ae,V as J,aL as ke,aM as $e,M,aN as ce,u as Ve,n as j,f as ve,p as O,j as Me,ay as Ce,g as He,ao as Be}from"./index-DsB6ypse.js";import{V as de}from"./VDialog-Dsy2KfsX.js";import{d as ne,V as ue,b as he,c as ye}from"./VCard-B9eVNnSx.js";import{V as pe}from"./ssrBoot-BvndLrcu.js";import{V as ie,a as K}from"./VRow-D8tNuKuV.js";import{c as Z,V as T,b as Se,a as E,d as Te}from"./VSelect-BjCImy0U.js";import{V as xe,a as Pe}from"./VPagination-BrFhG28F.js";import{V as Re}from"./VTooltip-QvwL3_6i.js";import{V as le}from"./Videos-BLwFv_ZS.js";import{V as _e}from"./VDivider-CaRre93T.js";const ze={class:"px-5 pb-6"},Ee={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-2"},Ie={class:"video-info__item"},Le={class:"video-info__item-value"},De={class:"video-info__item"},Ue={class:"video-info__item-value"},Ae={class:"video-info__item"},Fe={class:"video-info__item-value"},Oe={class:"video-info__item"},We={class:"video-info__item-value"},Ne={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},je={class:"video-info__item"},qe={class:"video-info__item-value"},Ye={class:"video-info__item"},Ge={class:"video-info__item-value"},Je={class:"video-info__item"},Ke={class:"video-info__item-value"},Qe={class:"video-info__item"},Ze={class:"video-info__item-value"},Xe={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},eo={class:"video-info__item"},oo={class:"video-info__item-value"},ro={class:"video-info__item"},to={class:"video-info__item-value"},so={class:"video-info__item"},ao={class:"video-info__item-value"},io={key:0,class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},lo={class:"video-info__item"},no={class:"video-info__item-value"},uo={class:"video-info__item"},po={class:"video-info__item-value"},mo={class:"video-info__item"},go={class:"video-info__item-value"},co=X({__name:"RecordedFileInfoDialog",props:{program:{},show:{type:Boolean}},emits:["update:show"],setup(A){return(u,s)=>{const k=G("Icon");return l(),w(de,{"max-width":"770",transition:"slide-y-transition","model-value":u.show,"onUpdate:modelValue":s[1]||(s[1]=$=>u.$emit("update:show",$))},{default:t(()=>[r(ne,{class:"video-info"},{default:t(()=>[r(ue,{class:"px-5 pt-6 pb-3 d-flex align-center font-weight-bold",style:{height:"60px"}},{default:t(()=>[r(k,{icon:"fluent:document-20-filled",height:"26px"}),s[2]||(s[2]=e("span",{class:"ml-3"},"録画ファイル情報",-1)),r(pe),P((l(),g("div",{class:"d-flex align-center rounded-circle cursor-pointer px-2 py-2",onClick:s[0]||(s[0]=$=>u.$emit("update:show",!1))},[r(k,{icon:"fluent:dismiss-12-filled",width:"23px",height:"23px"})])),[[N]])]),_:1}),e("div",ze,[e("div",Ee,[r(k,{icon:"fluent:video-clip-20-filled",width:"24px",height:"20px"}),s[3]||(s[3]=e("span",{class:"ml-2"},"ファイル情報",-1))]),e("div",Ie,[s[4]||(s[4]=e("div",{class:"video-info__item-label"},"ファイルパス",-1)),e("div",Le,p(u.program.recorded_video.file_path),1)]),e("div",De,[s[5]||(s[5]=e("div",{class:"video-info__item-label"},"ファイルサイズ",-1)),e("div",Ue,p(H(I).formatBytes(u.program.recorded_video.file_size)),1)]),e("div",Ae,[s[6]||(s[6]=e("div",{class:"video-info__item-label"},"録画期間",-1)),e("div",Fe,p(H(W).getRecordingTime(u.program)),1)]),e("div",Oe,[s[7]||(s[7]=e("div",{class:"video-info__item-label"},"最終更新日時",-1)),e("div",We,p(H(I).apply28HourClock(H(be)(u.program.recorded_video.file_modified_at).format("YYYY/MM/DD (dd) HH:mm:ss"))),1)]),e("div",Ne,[r(k,{icon:"fluent:video-20-filled",width:"24px",height:"20px"}),s[8]||(s[8]=e("span",{class:"ml-2"},"映像情報",-1))]),e("div",je,[s[9]||(s[9]=e("div",{class:"video-info__item-label"},"コーデック",-1)),e("div",qe,p(u.program.recorded_video.video_codec)+" ("+p(u.program.recorded_video.video_codec_profile)+")",1)]),e("div",Ye,[s[10]||(s[10]=e("div",{class:"video-info__item-label"},"解像度",-1)),e("div",Ge,p(u.program.recorded_video.video_resolution_width)+"×"+p(u.program.recorded_video.video_resolution_height),1)]),e("div",Je,[s[11]||(s[11]=e("div",{class:"video-info__item-label"},"フレームレート",-1)),e("div",Ke,p(u.program.recorded_video.video_frame_rate)+" fps",1)]),e("div",Qe,[s[12]||(s[12]=e("div",{class:"video-info__item-label"},"スキャン方式",-1)),e("div",Ze,p(u.program.recorded_video.video_scan_type),1)]),e("div",Xe,[r(k,{icon:"fluent:speaker-2-20-filled",width:"24px",height:"20px"}),s[13]||(s[13]=e("span",{class:"ml-2"},"音声情報（主音声）",-1))]),e("div",eo,[s[14]||(s[14]=e("div",{class:"video-info__item-label"},"コーデック",-1)),e("div",oo,p(u.program.recorded_video.primary_audio_codec),1)]),e("div",ro,[s[15]||(s[15]=e("div",{class:"video-info__item-label"},"チャンネル",-1)),e("div",to,p(u.program.recorded_video.primary_audio_channel),1)]),e("div",so,[s[16]||(s[16]=e("div",{class:"video-info__item-label"},"サンプリングレート",-1)),e("div",ao,p(u.program.recorded_video.primary_audio_sampling_rate?`${u.program.recorded_video.primary_audio_sampling_rate/1e3}kHz`:"不明"),1)]),u.program.recorded_video.secondary_audio_codec?(l(),g("div",io,[r(k,{icon:"fluent:speaker-2-20-filled",width:"24px",height:"20px"}),s[17]||(s[17]=e("span",{class:"ml-2"},"音声情報（副音声）",-1))])):h("",!0),u.program.recorded_video.secondary_audio_codec?(l(),g(U,{key:1},[e("div",lo,[s[18]||(s[18]=e("div",{class:"video-info__item-label"},"コーデック",-1)),e("div",no,p(u.program.recorded_video.secondary_audio_codec),1)]),e("div",uo,[s[19]||(s[19]=e("div",{class:"video-info__item-label"},"チャンネル",-1)),e("div",po,p(u.program.recorded_video.secondary_audio_channel),1)]),e("div",mo,[s[20]||(s[20]=e("div",{class:"video-info__item-label"},"サンプリングレート",-1)),e("div",go,p(u.program.recorded_video.secondary_audio_sampling_rate?`${u.program.recorded_video.secondary_audio_sampling_rate/1e3}kHz`:"不明"),1)])],64)):h("",!0)])]),_:1})]),_:1},8,["model-value"])}}}),vo=ee(co,[["__scopeId","data-v-904f7233"]]),_o={class:"encoding-dialog__program-info mb-4"},fo={class:"encoding-dialog__program-title"},ho={key:0,class:"encoding-dialog__program-meta"},yo={class:"encoding-dialog__program-channel"},bo={class:"encoding-dialog__program-time"},wo={class:"encoding-dialog__settings"},ko={class:"d-flex align-center"},$o={class:"text-caption"},Vo={class:"d-flex align-center"},Mo={class:"text-caption"},Co={class:"d-flex align-center"},Ho={class:"text-caption"},Bo={class:"d-flex align-center"},So=X({__name:"TSReplaceEncodingDialog",props:{show:{type:Boolean,default:!1},program:{}},emits:["update:show","encoding-started"],setup(A,{emit:u}){const s=A,k=u,$=D({get:()=>s.show,set:v=>k("update:show",v)}),c=B(!1),S=B(!1),d=B("h264"),n=B("software"),C=B("medium"),f=B(!1),oe=[{value:"h264",label:"H.264 (AVC)",description:"互換性が高く、多くのデバイスで再生可能",recommended:!0},{value:"hevc",label:"H.265 (HEVC)",description:"より高い圧縮効率、ファイルサイズが小さくなる",recommended:!1}],re=D(()=>[{value:"software",label:"ソフトウェアエンコード",description:"FFmpegを使用、時間がかかる",disabled:!1,fast:!1},{value:"hardware",label:"ハードウェアエンコード",description:S.value?"GPU/専用チップを使用、高速で高品質":"使用できません（対応するGPUが検出されませんでした）",disabled:!S.value,fast:!0}]),te=[{value:"fast",label:"高速",description:"エンコード時間を優先、品質は標準的",recommended:!1},{value:"medium",label:"標準",description:"バランスの取れた設定",recommended:!0},{value:"slow",label:"高品質",description:"品質を優先、エンコード時間は長くなる",recommended:!1}],q=D(()=>!(c.value||!s.program||s.program.recorded_video.is_tsreplace_encoded||n.value==="hardware"&&!S.value)),x=async()=>{try{const v=await ke.fetchHardwareEncoderStatus();S.value=v.hardware_encoder_available,!v.hardware_encoder_available&&n.value==="hardware"&&(n.value="software")}catch(v){console.error("Failed to check hardware encoder availability:",v),S.value=!1,n.value==="hardware"&&(n.value="software")}},se=async()=>{var v,i;if(!(!s.program||!q.value)){c.value=!0;try{const V=await $e.startManualEncoding({video_id:s.program.id,codec:d.value,encoder_type:n.value,quality_preset:C.value,delete_original:f.value});V&&V.success&&V.task_id?(M.success("エンコードを開始しました。"),k("encoding-started",V.task_id,d.value,n.value),c.value=!1,F()):M.error("エンコードの開始に失敗しました。")}catch(V){if(console.error("Failed to start encoding:",V),(i=(v=V==null?void 0:V.response)==null?void 0:v.data)!=null&&i.detail){const R=V.response.data.detail;R==="Cannot re-encode already encoded video"?M.error("再エンコード済みの動画は再度エンコードできません。"):M.error(`エンコードの開始に失敗しました: ${R}`)}else M.error("エンコードの開始に失敗しました。")}finally{c.value=!1}}},F=()=>{c.value||($.value=!1)};return Y(()=>s.show,v=>{v&&(x(),d.value="h264",n.value="software",C.value="medium",f.value=!1,c.value=!1)}),we(()=>{x()}),(v,i)=>{const V=G("Icon");return l(),w(de,{modelValue:$.value,"onUpdate:modelValue":i[4]||(i[4]=R=>$.value=R),"max-width":"600",persistent:""},{default:t(()=>[r(ne,null,{default:t(()=>[r(ue,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:t(()=>i[5]||(i[5]=[m(" 録画ファイルを再エンコード ")])),_:1}),r(he,{class:"pt-4 pb-0"},{default:t(()=>{var R,a,o,_;return[e("div",_o,[e("div",fo,p(((R=v.program)==null?void 0:R.title)||"取得中..."),1),v.program?(l(),g("div",ho,[e("span",yo,p(((a=v.program.channel)==null?void 0:a.name)||"チャンネル情報なし"),1),e("span",bo,p(H(W).getProgramTime(v.program)),1)])):h("",!0)]),e("div",wo,[r(ie,null,{default:t(()=>[r(K,{cols:"12",md:"6"},{default:t(()=>[r(Z,{modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=y=>d.value=y),items:oe,"item-title":"label","item-value":"value",label:"エンコードコーデック",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:c.value},{item:t(({props:y,item:b})=>[r(T,me(ge(y)),{title:t(()=>[e("div",ko,[e("span",null,p(b.raw.label),1),b.raw.recommended?(l(),w(Q,{key:0,size:"x-small",color:"primary",class:"ml-2"},{default:t(()=>i[6]||(i[6]=[m(" 推奨 ")])),_:1})):h("",!0)])]),subtitle:t(()=>[e("span",$o,p(b.raw.description),1)]),_:2},1040)]),_:1},8,["modelValue","disabled"])]),_:1}),r(K,{cols:"12",md:"6"},{default:t(()=>[r(Z,{modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=y=>n.value=y),items:re.value,"item-title":"label","item-value":"value",label:"エンコーダータイプ",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:c.value},{item:t(({props:y,item:b})=>[r(T,fe(y,{disabled:b.raw.disabled}),{title:t(()=>[e("div",Vo,[e("span",null,p(b.raw.label),1),b.raw.fast?(l(),w(Q,{key:0,size:"x-small",color:"success",class:"ml-2"},{default:t(()=>i[7]||(i[7]=[m(" 高速 ")])),_:1})):h("",!0)])]),subtitle:t(()=>[e("span",Mo,p(b.raw.description),1)]),_:2},1040,["disabled"])]),_:1},8,["modelValue","items","disabled"])]),_:1})]),_:1}),r(ie,null,{default:t(()=>[r(K,{cols:"12"},{default:t(()=>[r(Z,{modelValue:C.value,"onUpdate:modelValue":i[2]||(i[2]=y=>C.value=y),items:te,"item-title":"label","item-value":"value",label:"エンコード品質",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:c.value},{item:t(({props:y,item:b})=>[r(T,me(ge(y)),{title:t(()=>[e("div",Co,[e("span",null,p(b.raw.label),1),b.raw.recommended?(l(),w(Q,{key:0,size:"x-small",color:"primary",class:"ml-2"},{default:t(()=>i[8]||(i[8]=[m(" 推奨 ")])),_:1})):h("",!0)])]),subtitle:t(()=>[e("span",Ho,p(b.raw.description),1)]),_:2},1040)]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),!S.value&&n.value==="hardware"?(l(),w(ae,{key:0,type:"warning",variant:"tonal",class:"mt-4"},{title:t(()=>i[9]||(i[9]=[m("ハードウェアエンコーダーが利用できません")])),default:t(()=>[i[10]||(i[10]=m(" ハードウェアエンコーダーが検出されないか、設定で無効になっています。")),i[11]||(i[11]=e("br",null,null,-1)),i[12]||(i[12]=m(" ソフトウェアエンコードを使用してください。 "))]),_:1})):h("",!0),(o=v.program)!=null&&o.recorded_video.is_tsreplace_encoded?(l(),w(ae,{key:1,type:"error",variant:"tonal",class:"mt-4"},{title:t(()=>i[13]||(i[13]=[m("再エンコード済みの動画です")])),default:t(()=>[i[14]||(i[14]=m(" この録画ファイルは既に再エンコード済みです。")),i[15]||(i[15]=e("br",null,null,-1)),i[16]||(i[16]=m(" 再エンコード済みの動画は再度エンコードできません。 "))]),_:1})):((_=v.program)==null?void 0:_.recorded_video.video_codec)!=="MPEG-2"?(l(),w(ae,{key:2,type:"info",variant:"tonal",class:"mt-4"},{title:t(()=>i[17]||(i[17]=[m("既にエンコード済みのファイルです")])),default:t(()=>{var y;return[m(" この録画ファイルは既に "+p((y=v.program)==null?void 0:y.recorded_video.video_codec)+" でエンコードされています。",1),i[18]||(i[18]=e("br",null,null,-1)),i[19]||(i[19]=m(" 再エンコードすると画質が劣化する可能性があります。 "))]}),_:1})):h("",!0),r(ie,{class:"mt-4"},{default:t(()=>[r(K,{cols:"12"},{default:t(()=>[r(xe,{modelValue:f.value,"onUpdate:modelValue":i[3]||(i[3]=y=>f.value=y),disabled:c.value,label:"エンコード完了後に元ファイルを削除する","hide-details":"auto"},{label:t(()=>[e("div",Bo,[i[21]||(i[21]=e("span",null,"エンコード完了後に元ファイルを削除する",-1)),r(Re,{activator:"parent",location:"top"},{default:t(()=>i[20]||(i[20]=[e("span",null,[m("チェックすると、エンコード完了後に元のファイルが自動的に削除されます。"),e("br"),m(" 削除されたファイルは復元できませんので、十分注意してください。")],-1)])),_:1})])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})])]}),_:1}),r(ye,{class:"pt-4 px-6 pb-6"},{default:t(()=>[r(pe),r(J,{color:"text",variant:"text",onClick:F,disabled:c.value},{default:t(()=>[r(V,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),i[22]||(i[22]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1},8,["disabled"]),r(J,{class:"px-3",color:"primary",variant:"flat",onClick:se,disabled:!q.value,loading:c.value},{default:t(()=>[r(V,{icon:"fluent:arrow-sync-20-regular",width:"18px",height:"18px"}),i[23]||(i[23]=e("span",{class:"ml-1"},"エンコード開始",-1))]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),To=ee(So,[["__scopeId","data-v-b3c29d59"]]),xo={class:"recorded-program__container"},Po={class:"recorded-program__thumbnail"},Ro=["src"],zo={class:"recorded-program__thumbnail-duration"},Eo={key:0,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--recording"},Io={key:1,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--analyzing"},Lo={key:2,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--partial"},Do={key:3,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--encoding"},Uo={key:4,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--encoded"},Ao={key:5,class:"recorded-program__thumbnail-progress"},Fo={key:6,class:"recorded-program__thumbnail-progress recorded-program__thumbnail-progress--encoding"},Oo={class:"recorded-program__content"},Wo=["innerHTML"],No={class:"recorded-program__content-meta"},jo={key:0,class:"recorded-program__content-meta-broadcaster"},qo=["src"],Yo={class:"recorded-program__content-meta-broadcaster-name"},Go={key:1,class:"recorded-program__content-meta-broadcaster"},Jo={key:2,class:"recorded-program__content-meta-encoded"},Ko={class:"recorded-program__content-meta-time"},Qo=["innerHTML"],Zo={key:0,width:"22px",height:"22px",viewBox:"0 0 16 16"},Xo={key:0,width:"22px",height:"22px",viewBox:"0 0 16 16"},er={key:1,width:"22px",height:"22px",viewBox:"0 0 15.2 15.2"},or={class:"recorded-program__menu"},rr={class:"delete-confirmation__file-path mb-4"},tr=X({__name:"RecordedProgram",props:{program:{},forMylist:{type:Boolean,default:!1},forWatchedHistory:{type:Boolean,default:!1}},emits:["deleted","encoding-started"],setup(A,{emit:u}){const s=A,k=u,$=B(!1),c=B(!1),S=B(!1),d=ce(),n=D(()=>d.getAllTasks().some(o=>o.programTitle===s.program.title&&["queued","processing"].includes(o.status))),C=D(()=>{const o=d.getAllTasks().find(_=>_.programTitle===s.program.title&&["queued","processing"].includes(_.status));return o?{progress:o.progress,status:o.status,codec:o.codec,encoderType:o.encoderType}:null}),f=(a="original")=>{const o=`${I.api_base_url}/videos/${s.program.id}/download?file_type=${a}`;window.location.href=o},oe=()=>{S.value=!0},re=(a,o,_)=>{ce().addTask(a,s.program.title,o,_),k("encoding-started",a),console.log("Encoding started with task ID:",a)},te=async()=>{M.success("メタデータの再解析を開始します。完了までしばらくお待ちください。"),await le.reanalyzeVideo(s.program.id)===!0&&M.success("メタデータの再解析が完了しました。")},q=async(a=!1)=>{M.success("サムネイルの再作成を開始しました。完了までしばらくお待ちください。"),await le.regenerateThumbnail(s.program.id,a)===!0&&M.success("サムネイルの再作成が完了しました。")},x=Ve(),se=()=>{x.settings.mylist.some(o=>o.type==="RecordedProgram"&&o.id===s.program.id)?(x.settings.mylist=x.settings.mylist.filter(o=>!(o.type==="RecordedProgram"&&o.id===s.program.id)),M.show("マイリストから削除しました。")):(x.settings.mylist.push({type:"RecordedProgram",id:s.program.id,created_at:I.time()}),M.success("マイリストに追加しました。"))},F=D(()=>x.settings.mylist.some(a=>a.type==="RecordedProgram"&&a.id===s.program.id)),v=D(()=>x.settings.watched_history.find(a=>a.video_id===s.program.id)),i=()=>{x.settings.watched_history=x.settings.watched_history.filter(a=>a.video_id!==s.program.id),M.show("視聴履歴から削除しました。")},V=()=>{const a=Ce();if(a.user===null||a.user.is_admin===!1){M.warning(`録画ファイルを削除するには管理者権限が必要です。
管理者アカウントでログインし直してください。`);return}c.value=!0},R=async()=>{c.value=!1,M.info("録画ファイルの削除を開始します。完了までしばらくお待ちください。"),await le.deleteVideo(s.program.id)===!0&&(M.success("録画ファイルを削除しました。"),k("deleted",s.program.id))};return(a,o)=>{const _=G("Icon"),y=G("router-link"),b=Me("ftooltip");return l(),g(U,null,[P((l(),w(y,{class:j(["recorded-program",{"recorded-program--recording":a.program.recorded_video.status==="Recording","recorded-program--analyzing":!a.program.recorded_video.has_key_frames,"recorded-program--encoding":n.value}]),to:a.program.recorded_video.status==="Recording"||!a.program.recorded_video.has_key_frames||n.value?{path:""}:`/videos/watch/${a.program.id}`},{default:t(()=>{var z;return[e("div",xo,[e("div",Po,[e("img",{class:"recorded-program__thumbnail-image",loading:"lazy",decoding:"async",src:`${H(I).api_base_url}/videos/${a.program.id}/thumbnail`},null,8,Ro),e("div",zo,p(H(W).getProgramDuration(a.program)),1),a.program.recorded_video.status==="Recording"?(l(),g("div",Eo,o[14]||(o[14]=[e("div",{class:"recorded-program__thumbnail-status-dot"},null,-1),m(" 録画中 ")]))):a.program.recorded_video.has_key_frames?a.program.is_partially_recorded?(l(),g("div",Lo," ⚠️ 一部のみ録画 ")):n.value&&C.value?(l(),g("div",Do,[r(_,{icon:"fluent:arrow-sync-12-regular",width:"15px",height:"15px",class:"recorded-program__thumbnail-status-icon--spin"}),m(" エンコード中 ("+p(Math.round(C.value.progress))+"%) ",1)])):(z=a.program)!=null&&z.recorded_video.is_tsreplace_encoded?(l(),g("div",Uo,[r(_,{icon:"fluent:checkmark-circle-12-regular",width:"15px",height:"15px"}),o[16]||(o[16]=m(" 再エンコード済み "))])):h("",!0):(l(),g("div",Io,[r(_,{icon:"fluent:clock-12-regular",width:"15px",height:"15px"}),o[15]||(o[15]=m(" メタデータ解析中 "))])),v.value&&!n.value?(l(),g("div",Ao,[e("div",{class:"recorded-program__thumbnail-progress-bar",style:ve(`width: ${v.value.last_playback_position/a.program.recorded_video.duration*100}%`)},null,4)])):n.value&&C.value?(l(),g("div",Fo,[e("div",{class:"recorded-program__thumbnail-progress-bar recorded-program__thumbnail-progress-bar--encoding",style:ve(`width: ${C.value.progress}%`)},null,4)])):h("",!0)]),e("div",Oo,[e("div",{class:"recorded-program__content-title",innerHTML:H(W).decorateProgramInfo(a.program,"title")},null,8,Wo),e("div",No,[a.program.channel?(l(),g("div",jo,[e("img",{class:"recorded-program__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${H(I).api_base_url}/channels/${a.program.channel.id}/logo`},null,8,qo),e("span",Yo,"Ch: "+p(a.program.channel.channel_number)+" "+p(a.program.channel.name),1)])):(l(),g("div",Go,o[17]||(o[17]=[e("span",{class:"recorded-program__content-meta-broadcaster-name"},"チャンネル情報なし",-1)]))),a.program.recorded_video.is_tsreplace_encoded?(l(),g("div",Jo,[r(Q,{size:"x-small",color:"success",variant:"tonal"},{default:t(()=>[r(_,{icon:"fluent:checkmark-circle-12-regular",width:"12px",height:"12px",class:"mr-1"}),o[18]||(o[18]=m(" 再エンコード済み "))]),_:1})])):h("",!0),e("div",Ko,p(H(W).getProgramTime(a.program)),1)]),e("div",{class:"recorded-program__content-description",innerHTML:H(W).decorateProgramInfo(a.program,"description")},null,8,Qo)]),a.forWatchedHistory?h("",!0):P((l(),g("div",{key:0,class:j(["recorded-program__mylist",{"recorded-program__mylist--highlight":F.value&&!a.forMylist}]),onClick:O(se,["prevent","stop"]),onMousedown:o[0]||(o[0]=O(()=>{},["prevent","stop"]))},[a.forMylist?(l(),g("svg",Zo,o[19]||(o[19]=[e("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0M6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0zM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5"},null,-1)]))):(l(),g(U,{key:1},[F.value?(l(),g("svg",Xo,o[20]||(o[20]=[e("path",{fill:"currentColor",d:"M14.046 3.486a.75.75 0 0 1-.032 1.06l-7.93 7.474a.85.85 0 0 1-1.188-.022l-2.68-2.72a.75.75 0 1 1 1.068-1.053l2.234 2.267l7.468-7.038a.75.75 0 0 1 1.06.032"},null,-1)]))):(l(),g("svg",er,o[21]||(o[21]=[e("path",{fill:"currentColor",d:"M8 2.5a.5.5 0 0 0-1 0V7H2.5a.5.5 0 0 0 0 1H7v4.5a.5.5 0 0 0 1 0V8h4.5a.5.5 0 0 0 0-1H8z"},null,-1)])))],64))],34)),[[N],[b,F.value?"マイリストから削除する":"マイリストに追加する"]]),a.forWatchedHistory?P((l(),g("div",{key:1,class:"recorded-program__mylist",onClick:O(i,["prevent","stop"]),onMousedown:o[1]||(o[1]=O(()=>{},["prevent","stop"]))},o[22]||(o[22]=[e("svg",{width:"22px",height:"22px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0M6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0zM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5"})],-1)]),32)),[[N],[b,"視聴履歴から削除する"]]):h("",!0),e("div",or,[r(Te,{location:"bottom end","close-on-content-click":!0},{activator:t(({props:L})=>[P((l(),g("div",fe({class:"recorded-program__menu-button"},L,{onClick:o[2]||(o[2]=O(()=>{},["prevent","stop"])),onMousedown:o[3]||(o[3]=O(()=>{},["prevent","stop"]))}),o[23]||(o[23]=[e("svg",{width:"19px",height:"19px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M9.5 13a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0"})],-1)]),16)),[[N]])]),default:t(()=>[r(Se,{density:"compact","bg-color":"background-lighten-1",class:"recorded-program__menu-list"},{default:t(()=>[r(T,{onClick:o[4]||(o[4]=L=>$.value=!0)},{prepend:t(()=>o[24]||(o[24]=[e("svg",{width:"20px",height:"20px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M8.499 7.5a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0zm.25-2a.749.749 0 1 1-1.499 0a.749.749 0 0 1 1.498 0M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1M2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8"})],-1)])),default:t(()=>[r(E,{class:"ml-3"},{default:t(()=>o[25]||(o[25]=[m("録画ファイル情報を表示")])),_:1})]),_:1}),a.program.recorded_video.is_tsreplace_encoded?(l(),g(U,{key:0},[r(T,{onClick:o[5]||(o[5]=L=>f("original")),disabled:a.program.recorded_video.status==="Recording"||n.value},{prepend:t(()=>[r(_,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:t(()=>[r(E,{class:"ml-3"},{default:t(()=>[m("元ファイルをダウンロード ("+p(H(I).formatBytes(a.program.recorded_video.file_size))+")",1)]),_:1})]),_:1},8,["disabled"]),r(T,{onClick:o[6]||(o[6]=L=>f("encoded")),disabled:a.program.recorded_video.status==="Recording"||n.value},{prepend:t(()=>[r(_,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:t(()=>[r(E,{class:"ml-3"},{default:t(()=>o[26]||(o[26]=[m("エンコード済みファイルをダウンロード")])),_:1})]),_:1},8,["disabled"])],64)):(l(),w(T,{key:1,onClick:o[7]||(o[7]=L=>f("original")),disabled:a.program.recorded_video.status==="Recording"||n.value},{prepend:t(()=>[r(_,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:t(()=>[r(E,{class:"ml-3"},{default:t(()=>[m("録画ファイルをダウンロード ("+p(H(I).formatBytes(a.program.recorded_video.file_size))+")",1)]),_:1})]),_:1},8,["disabled"])),P((l(),w(T,{onClick:te},{prepend:t(()=>[r(_,{icon:"fluent:book-arrow-clockwise-20-regular",width:"20px",height:"20px"})]),default:t(()=>[r(E,{class:"ml-3"},{default:t(()=>o[27]||(o[27]=[m("メタデータを再解析")])),_:1})]),_:1})),[[b,"再生時に必要な録画ファイル情報や番組情報などを解析し直します"]]),P((l(),w(T,{onClick:o[8]||(o[8]=L=>q(!0))},{prepend:t(()=>[r(_,{icon:"fluent:image-arrow-counterclockwise-24-regular",width:"20px",height:"20px"})]),default:t(()=>[r(E,{class:"ml-3"},{default:t(()=>o[28]||(o[28]=[m("サムネイルを更新")])),_:1})]),_:1})),[[b,"既存のシークバー用サムネイルから代表サムネイルを選び直します 変更反映にはブラウザキャッシュの削除が必要です"]]),P((l(),w(T,{onClick:o[9]||(o[9]=L=>q(!1))},{prepend:t(()=>[r(_,{icon:"fluent:image-arrow-counterclockwise-24-regular",width:"20px",height:"20px"})]),default:t(()=>[r(E,{class:"ml-3"},{default:t(()=>o[29]||(o[29]=[m("サムネイルを再作成")])),_:1})]),_:1})),[[b,"サムネイルを完全に作り直します（数分かかります） 変更反映にはブラウザキャッシュの削除が必要です"]]),r(_e),P((l(),w(T,{onClick:oe,disabled:a.program.recorded_video.status==="Recording"||n.value||a.program.recorded_video.is_tsreplace_encoded},{prepend:t(()=>[r(_,{icon:"fluent:arrow-sync-20-regular",width:"20px",height:"20px"})]),default:t(()=>[r(E,{class:"ml-3"},{default:t(()=>o[30]||(o[30]=[m("録画ファイルを再エンコード")])),_:1})]),_:1},8,["disabled"])),[[b,a.program.recorded_video.is_tsreplace_encoded?"再エンコード済みの動画は再度エンコードできません":"録画ファイルをH.264またはHEVCに再エンコードします"]]),r(_e),r(T,{onClick:V,disabled:a.program.recorded_video.status==="Recording"||n.value,class:"recorded-program__menu-list-item--danger"},{prepend:t(()=>[r(_,{icon:"fluent:delete-24-regular",width:"20px",height:"20px"})]),default:t(()=>[r(E,{class:"ml-3"},{default:t(()=>o[31]||(o[31]=[m("録画ファイルを削除")])),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})])])]}),_:1},8,["to","class"])),[[N]]),r(vo,{program:a.program,show:$.value,"onUpdate:show":o[10]||(o[10]=z=>$.value=z)},null,8,["program","show"]),r(de,{"max-width":"750",modelValue:c.value,"onUpdate:modelValue":o[12]||(o[12]=z=>c.value=z)},{default:t(()=>[r(ne,null,{default:t(()=>[r(ue,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:t(()=>o[32]||(o[32]=[m("本当に録画ファイルを削除しますか？")])),_:1}),r(he,{class:"pt-2 pb-0"},{default:t(()=>[e("div",rr,p(a.program.recorded_video.file_path),1),o[33]||(o[33]=e("div",{class:"text-error-lighten-1 font-weight-bold"},[m(" この録画ファイルに関連するすべてのデータ (サムネイル / .ts.program.txt / .ts.err を含む) が削除されます。"),e("br"),m(" 元に戻すことはできません。本当に録画ファイルを削除しますか？ ")],-1))]),_:1}),r(ye,{class:"pt-4 px-6 pb-6"},{default:t(()=>[r(pe),r(J,{color:"text",variant:"text",onClick:o[11]||(o[11]=z=>c.value=!1)},{default:t(()=>[r(_,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),o[34]||(o[34]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),r(J,{class:"px-3",color:"error",variant:"flat",onClick:R},{default:t(()=>[r(_,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),o[35]||(o[35]=e("span",{class:"ml-1"},"録画ファイルを削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(To,{show:S.value,"onUpdate:show":o[13]||(o[13]=z=>S.value=z),program:a.program,onEncodingStarted:re},null,8,["show","program"])],64)}}}),sr=ee(tr,[["__scopeId","data-v-7889d868"]]),ar={key:0,class:"recorded-program-list__header"},ir={class:"recorded-program-list__title"},lr={class:"recorded-program-list__title-text"},dr={key:1,class:"recorded-program-list__title-count"},nr={class:"recorded-program-list__empty-content"},ur=["innerHTML"],pr=["innerHTML"],mr={class:"recorded-program-list__grid-content"},gr={key:1,class:"recorded-program-list__pagination"},cr=X({__name:"RecordedProgramList",props:{title:{},programs:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画番組が見つかりませんでした。"},emptySubMessage:{default:'サーバー設定で録画フォルダのパスを<br class="d-sm-none">正しく設定できているか確認してください。'},isLoading:{type:Boolean,default:!1},isSearching:{type:Boolean,default:!1},forMylist:{type:Boolean,default:!1},forWatchedHistory:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more"],setup(A){Be();const u=A,s=B(u.page),k=B(u.sortOrder),$=B([...u.programs]),c=B(u.total);Y(()=>u.page,d=>{s.value=d}),Y(()=>u.sortOrder,d=>{k.value=d}),Y(()=>u.programs,d=>{$.value=[...d]}),Y(()=>u.total,d=>{c.value=d});const S=d=>{$.value=$.value.filter(n=>n.id!==d),c.value--};return(d,n)=>{const C=G("Icon");return l(),g("div",{class:j(["recorded-program-list",{"recorded-program-list--show-sort":!d.hideSort}])},[d.hideHeader?h("",!0):(l(),g("div",ar,[e("h2",ir,[d.showBackButton?P((l(),g("div",{key:0,class:"recorded-program-list__title-back",onClick:n[0]||(n[0]=f=>d.$router.back())},[r(C,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[N]]):h("",!0),e("span",lr,p(d.title),1),d.showMoreButton?h("",!0):(l(),g("div",dr,[d.isSearching?(l(),g(U,{key:0},[r(C,{icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"}),n[6]||(n[6]=e("span",null,"検索中...",-1))],64)):(l(),g(U,{key:1},[m(p(c.value)+"件",1)],64))]))]),e("div",{class:j(["recorded-program-list__actions",{"recorded-program-list__actions--mylist":d.forMylist}])},[d.hideSort?h("",!0):(l(),w(Z,{key:0,modelValue:k.value,"onUpdate:modelValue":[n[1]||(n[1]=f=>k.value=f),n[2]||(n[2]=f=>d.$emit("update:sortOrder",f))],items:d.forMylist?[{title:"追加が新しい順",value:"mylist_added_desc"},{title:"追加が古い順",value:"mylist_added_asc"},{title:"録画が新しい順",value:"recorded_desc"},{title:"録画が古い順",value:"recorded_asc"}]:[{title:"新しい順",value:"desc"},{title:"古い順",value:"asc"}],"item-title":"title","item-value":"value",class:"recorded-program-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue","items"])),d.showMoreButton?(l(),w(J,{key:1,variant:"text",class:"recorded-program-list__more",onClick:n[3]||(n[3]=f=>d.$emit("more"))},{default:t(()=>[n[7]||(n[7]=e("span",{class:"text-primary"},"もっと見る",-1)),r(C,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):h("",!0)],2)])),e("div",{class:j(["recorded-program-list__grid",{"recorded-program-list__grid--loading":d.isLoading||d.isSearching,"recorded-program-list__grid--empty":c.value===0&&d.showEmptyMessage,"recorded-program-list__grid--searching":d.isSearching}])},[e("div",{class:j(["recorded-program-list__empty",{"recorded-program-list__empty--show":c.value===0&&d.showEmptyMessage&&!d.isSearching}])},[e("div",nr,[r(C,{class:"recorded-program-list__empty-icon",icon:d.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),e("h2",{innerHTML:d.emptyMessage},null,8,ur),d.emptySubMessage?(l(),g("div",{key:0,class:"recorded-program-list__empty-submessage",innerHTML:d.emptySubMessage},null,8,pr)):h("",!0)])],2),e("div",mr,[(l(!0),g(U,null,He($.value,f=>(l(),w(sr,{key:f.id,program:f,forMylist:d.forMylist,forWatchedHistory:d.forWatchedHistory,onDeleted:S},null,8,["program","forMylist","forWatchedHistory"]))),128))])],2),!d.hidePagination&&c.value>0?(l(),g("div",gr,[r(Pe,{modelValue:s.value,"onUpdate:modelValue":[n[4]||(n[4]=f=>s.value=f),n[5]||(n[5]=f=>d.$emit("update:page",f))],"active-color":"primary",density:"comfortable",length:Math.ceil(c.value/30),"total-visible":H(I).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):h("",!0)],2)}}}),Mr=ee(cr,[["__scopeId","data-v-6ade5cfc"]]);export{Mr as R};
