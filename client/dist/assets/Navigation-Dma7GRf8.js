import{d as T,a2 as U,E as P,G as z,s as G,q as S,N as O,c as $,w as p,a as i,e as A,b as l,k as m,h as c,am as K,r as x,v as j,y as B,V as w,O as F,l as R,t as q,o as h,R as g,_ as E,a3 as J,a4 as Q,e2 as X,dl as Y,aF as Z,aG as W,aE as tt,d9 as et,db as nt,a5 as at,e3 as st,av as it,aH as ot,a7 as rt,ak as lt,aw as ut,e4 as vt,ax as ct,e5 as dt,aU as _t,aV as ft,aJ as ht,ay as pt,aW as gt,e6 as mt,n as f,B as D,C as kt,U as I,m as yt,j as bt}from"./index-DJnqFb91.js";import{V as H,_ as wt,u as St}from"./ssrBoot-DvxYJLiV.js";function xt(t,e,a,r){function u(n){return n instanceof a?n:new a(function(o){o(n)})}return new(a||(a=Promise))(function(n,o){function v(_){try{s(r.next(_))}catch(b){o(b)}}function y(_){try{s(r.throw(_))}catch(b){o(b)}}function s(_){_.done?n(_.value):u(_.value).then(v,y)}s((r=r.apply(t,[])).next())})}function Ct(t,e){var a={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,u,n,o;return o={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function v(s){return function(_){return y([s,_])}}function y(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,u&&(n=s[0]&2?u.return:s[0]?u.throw||((n=u.return)&&n.call(u),0):u.next)&&!(n=n.call(u,s[1])).done)return n;switch(u=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,u=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(n=a.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){a=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){a.label=s[1];break}if(s[0]===6&&a.label<n[1]){a.label=n[1],n=s;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(s);break}n[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(_){s=[6,_],u=0}finally{r=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}var Wt=function(){function t(){var e=this;this.event=null,this.callbacks=[],this.install=function(){return xt(e,void 0,void 0,function(){var a=this;return Ct(this,function(r){switch(r.label){case 0:return this.event?(this.event.prompt(),[4,this.event.userChoice.then(function(u){var n=u.outcome;return a.updateEvent(null),n==="accepted"})]):[3,2];case 1:return[2,r.sent()];case 2:throw new Error("Not allowed to prompt.")}})})},!(typeof window>"u")&&(window.addEventListener("beforeinstallprompt",function(a){a.preventDefault(),e.updateEvent(a)}),window.addEventListener("appinstalled",function(){e.updateEvent(null)}))}return t.prototype.getEvent=function(){return this.event},t.prototype.canInstall=function(){return this.event!==null},t.prototype.updateEvent=function(e){var a=this;e!==this.event&&(this.event=e,this.callbacks.forEach(function(r){return r(a.canInstall())}))},t.prototype.addListener=function(e){e(this.canInstall()),this.callbacks.push(e)},t.prototype.removeListener=function(e){this.callbacks=this.callbacks.filter(function(a){return e!==a})},t}(),L=new Wt;const $t={class:"header"},Vt={key:0,class:"search-box"},Bt=["placeholder"],It=T({__name:"HeaderBar",setup(t){const e=U(),a=P(!1),r=P(""),u=F(),n=O(),o=()=>{n.path.endsWith("/search")&&n.query.query&&(r.value=decodeURIComponent(n.query.query))};z(()=>{L.addListener(d=>{a.value=d}),o()}),G(()=>n.fullPath,o);const v=S(()=>n.path.startsWith("/videos")||n.path.startsWith("/mylist")||n.path.startsWith("/watched-history")||n.path.startsWith("/offline")?"録画番組を検索...":"放送予定の番組を検索..."),y=()=>n.path.startsWith("/videos")||n.path.startsWith("/mylist")||n.path.startsWith("/watched-history")||n.path.startsWith("/offline")?"/videos/search":"/tv/search",s=d=>{d.key==="Enter"&&!d.isComposing&&_()},_=()=>{if(r.value.trim()){const d=y();u.push(`${d}?query=${encodeURIComponent(r.value.trim())}`)}},b=S(()=>{const d=n.path;return!d.startsWith("/captures")&&!d.startsWith("/settings")&&!d.startsWith("/login")&&!d.startsWith("/register")&&!d.startsWith("/offline")}),C=()=>{const d=!e.is_offline_mode;e.setOfflineMode(d),d?u.push("/offline"):n.path.startsWith("/offline")&&u.push("/videos")};return(d,k)=>{const M=x("router-link"),V=x("Icon");return h(),$("header",$t,[p((h(),m(M,{class:"konomitv-logo ml-3 ml-md-6",to:"/tv/"},{default:c(()=>[...k[2]||(k[2]=[l("img",{class:"konomitv-logo__image",src:wt,height:"21"},null,-1)])]),_:1})),[[g]]),i(H),b.value?(h(),$("div",Vt,[p(l("input",{class:"search-input",type:"search",enterkeyhint:"search",placeholder:v.value,"onUpdate:modelValue":k[0]||(k[0]=N=>r.value=N),onKeydown:s},null,40,Bt),[[K,r.value]]),i(V,{class:"search-input__icon",icon:"fluent:search-20-filled",height:"24px",onClick:_})])):A("",!0),p(i(w,{variant:"flat",class:"pwa-install-button",onClick:k[1]||(k[1]=N=>B(L).install())},{default:c(()=>[i(V,{icon:"material-symbols:install-desktop-rounded",height:"20px",class:"mr-1"}),k[3]||(k[3]=R(" アプリとしてインストール ",-1))]),_:1},512),[[j,a.value]]),i(w,{variant:"flat",class:"offline-mode-toggle-button",onClick:C},{default:c(()=>[i(V,{icon:B(e).is_offline_mode?"fluent:wifi-off-24-filled":"fluent:wifi-1-24-filled",height:"20px",class:"mr-1"},null,8,["icon"]),R(" "+q(B(e).is_offline_mode?"オフラインモード":"オンライン"),1)]),_:1}),k[4]||(k[4]=l("div",{class:"mr-3 mr-md-6"},null,-1))])}}}),Kt=E(It,[["__scopeId","data-v-4e4e31b8"]]),Et=Q({baseColor:String,bgColor:String,color:String,grow:Boolean,mode:{type:String,validator:t=>!t||["horizontal","shift"].includes(t)},height:{type:[Number,String],default:56},active:{type:Boolean,default:!0},...gt(),...pt(),...ht(),...ft(),..._t(),...dt({name:"bottom-navigation"}),...ct({tag:"header"}),...vt({selectedClass:"v-btn--selected"}),...ut()},"VBottomNavigation"),Nt=J()({name:"VBottomNavigation",props:Et(),emits:{"update:active":t=>!0,"update:modelValue":t=>!0},setup(t,e){let{slots:a}=e;const{themeClasses:r}=X(),{borderClasses:u}=Y(t),{backgroundColorClasses:n,backgroundColorStyles:o}=Z(W(t,"bgColor")),{densityClasses:v}=tt(t),{elevationClasses:y}=et(t),{roundedClasses:s}=nt(t),{ssrBootStyles:_}=St(),b=S(()=>Number(t.height)-(t.density==="comfortable"?8:0)-(t.density==="compact"?16:0)),C=at(t,"active",t.active),{layoutItemStyles:d}=st({id:t.name,order:S(()=>parseInt(t.order,10)),position:S(()=>"bottom"),layoutSize:S(()=>C.value?b.value:0),elementSize:b,active:C,absolute:W(t,"absolute")});return it(t,mt),ot({VBtn:{baseColor:W(t,"baseColor"),color:W(t,"color"),density:W(t,"density"),stacked:S(()=>t.mode!=="horizontal"),variant:"text"}},{scoped:!0}),rt(()=>i(t.tag,{class:["v-bottom-navigation",{"v-bottom-navigation--active":C.value,"v-bottom-navigation--grow":t.grow,"v-bottom-navigation--shift":t.mode==="shift"},r.value,n.value,u.value,v.value,y.value,s.value,t.class],style:[o.value,d.value,{height:lt(b.value)},_.value,t.style]},{default:()=>[a.default&&i("div",{class:"v-bottom-navigation__content"},[a.default()])]})),{}}}),Pt={};function Rt(t,e){const a=x("Icon");return h(),m(Nt,{class:"bottom-navigation-container elevation-12",color:"primary",grow:"",active:""},{default:c(()=>[i(w,{class:f(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/tv")}]),to:"/tv/"},{default:c(()=>[i(a,{icon:"fluent:tv-20-regular",width:"30px"}),e[0]||(e[0]=l("span",{class:"mt-1"},"テレビをみる",-1))]),_:1},8,["class"]),i(w,{class:f(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/videos")}]),to:"/videos/"},{default:c(()=>[i(a,{icon:"fluent:movies-and-tv-20-regular",width:"30px"}),e[1]||(e[1]=l("span",{class:"mt-1"},"ビデオをみる",-1))]),_:1},8,["class"]),i(w,{class:f(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/offline")}]),to:"/offline/"},{default:c(()=>[i(a,{icon:"fluent:arrow-download-24-regular",width:"30px"}),e[2]||(e[2]=l("span",{class:"mt-1"},"オフライン",-1))]),_:1},8,["class"]),i(w,{class:f(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/reservations")}]),to:"/reservations/"},{default:c(()=>[i(a,{icon:"fluent:timer-16-regular",width:"30px"}),e[3]||(e[3]=l("span",{class:"mt-1"},"録画予約",-1))]),_:1},8,["class"]),i(w,{class:f(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/captures")}]),to:"/captures/"},{default:c(()=>[i(a,{icon:"fluent:image-multiple-24-regular",width:"30px"}),e[4]||(e[4]=l("span",{class:"mt-1"},"キャプチャ",-1))]),_:1},8,["class"]),i(w,{class:f(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/mypage")}]),to:"/mypage/"},{default:c(()=>[i(a,{icon:"fluent:person-20-regular",width:"30px"}),e[5]||(e[5]=l("span",{class:"mt-1"},"マイページ",-1))]),_:1},8,["class"])]),_:1})}const Dt=E(Pt,[["render",Rt],["__scopeId","data-v-5fc10674"]]);class Lt{static async fetchServerVersion(e=!1){const a=await D.get("/version");return a.type==="error"?(e===!1&&D.showGenericError(a,"バージョン情報を取得できませんでした。"),null):a.data}}const Tt=kt("version",{state:()=>({server_version_info:null,last_updated_at:0}),getters:{client_version(){return I.version},server_version(){var t;return((t=this.server_version_info)==null?void 0:t.version)??null},latest_version(){var t;return((t=this.server_version_info)==null?void 0:t.latest_version)??null},is_client_develop_version(){return this.client_version.includes("-dev")},is_server_develop_version(){var t;return((t=this.server_version)==null?void 0:t.includes("-dev"))??!1},is_update_available(){return this.server_version===null||this.latest_version===null?!1:this.is_server_develop_version===!1&&this.server_version!==this.latest_version||this.is_server_develop_version===!0&&this.server_version.replace("-dev","")===this.latest_version},is_version_mismatch(){return this.server_version===null?!1:this.client_version!==this.server_version},server_environment(){var t;return((t=this.server_version_info)==null?void 0:t.environment)??null},is_linux_environment(){const t=this.server_environment;return t==="Linux"||t==="Linux-Docker"||t==="Linux-ARM"}},actions:{async fetchServerVersion(t=!1){if(this.server_version_info!==null&&t===!1)return I.time()-this.last_updated_at>60&&this.fetchServerVersion(!0),this.server_version_info;const e=await Lt.fetchServerVersion();return e===null?null:(this.server_version_info=e,this.last_updated_at=I.time(),this.server_version_info)}}}),qt=T({name:"Navigation",components:{BottomNavigation:Dt},computed:{...yt(Tt)},async created(){await this.versionStore.fetchServerVersion()}}),Ht={class:"navigation-container elevation-8"},Mt={class:"navigation"},Ut={class:"navigation-scroll"},zt={class:"navigation__link-text"};function Gt(t,e,a,r,u,n){const o=x("Icon"),v=x("router-link"),y=x("BottomNavigation"),s=bt("ftooltip");return h(),$("div",null,[l("div",Ht,[l("nav",Mt,[l("div",Ut,[p((h(),m(v,{class:f(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/tv")}]),"active-class":"navigation__link--active",to:"/tv/"},{default:c(()=>[i(o,{class:"navigation__link-icon",icon:"fluent:tv-20-regular",width:"26px"}),e[0]||(e[0]=l("span",{class:"navigation__link-text"},"テレビをみる",-1))]),_:1},8,["class"])),[[g]]),p((h(),m(v,{class:f(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/videos")}]),"active-class":"navigation__link--active",to:"/videos/"},{default:c(()=>[i(o,{class:"navigation__link-icon",icon:"fluent:movies-and-tv-20-regular",width:"26px"}),e[1]||(e[1]=l("span",{class:"navigation__link-text"},"ビデオをみる",-1))]),_:1},8,["class"])),[[g]]),p((h(),m(v,{class:f(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/offline")}]),"active-class":"navigation__link--active",to:"/offline/"},{default:c(()=>[i(o,{class:"navigation__link-icon",icon:"fluent:arrow-download-24-regular",width:"26px"}),e[2]||(e[2]=l("span",{class:"navigation__link-text"},"オフライン視聴",-1))]),_:1},8,["class"])),[[g]]),p((h(),m(v,{class:f(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/timetable")}]),"active-class":"navigation__link--active",to:"/timetable/"},{default:c(()=>[i(o,{class:"navigation__link-icon",icon:"fluent:calendar-ltr-20-regular",width:"26px"}),e[3]||(e[3]=l("span",{class:"navigation__link-text"},"番組表",-1))]),_:1},8,["class"])),[[g]]),p((h(),m(v,{class:f(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/reservations")}]),"active-class":"navigation__link--active",to:"/reservations/"},{default:c(()=>[i(o,{class:"navigation__link-icon",icon:"fluent:timer-16-regular",width:"26px",style:{padding:"0.5px"}}),e[4]||(e[4]=l("span",{class:"navigation__link-text"},"録画予約",-1))]),_:1},8,["class"])),[[g]]),p((h(),m(v,{class:f(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/captures")}]),"active-class":"navigation__link--active",to:"/captures/"},{default:c(()=>[i(o,{class:"navigation__link-icon",icon:"fluent:image-multiple-24-regular",width:"26px"}),e[5]||(e[5]=l("span",{class:"navigation__link-text"},"キャプチャ",-1))]),_:1},8,["class"])),[[g]]),p((h(),m(v,{class:f(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/mylist")}]),"active-class":"navigation__link--active",to:"/mylist/"},{default:c(()=>[i(o,{class:"navigation__link-icon",icon:"ic:round-playlist-play",width:"26px"}),e[6]||(e[6]=l("span",{class:"navigation__link-text"},"マイリスト",-1))]),_:1},8,["class"])),[[g]]),p((h(),m(v,{class:f(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/watched-history")}]),"active-class":"navigation__link--active",to:"/watched-history/"},{default:c(()=>[i(o,{class:"navigation__link-icon",icon:"fluent:history-20-regular",width:"26px"}),e[7]||(e[7]=l("span",{class:"navigation__link-text"},"視聴履歴",-1))]),_:1},8,["class"])),[[g]]),i(H),p((h(),m(v,{class:f(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/settings")}]),"active-class":"navigation__link--active",to:"/settings/"},{default:c(()=>[i(o,{class:"navigation__link-icon",icon:"fluent:settings-20-regular",width:"26px"}),e[8]||(e[8]=l("span",{class:"navigation__link-text"},"設定",-1))]),_:1},8,["class"])),[[g]]),p((h(),$("a",{class:f(["navigation__link",{"navigation__link--develop-version":t.versionStore.is_client_develop_version,"navigation__link--highlight":t.versionStore.is_update_available}]),"active-class":"navigation__link--active",href:"https://github.com/tsukumijima/KonomiTV",target:"_blank"},[i(o,{class:"navigation__link-icon",icon:"fluent:info-16-regular",width:"26px"}),l("span",zt,"version "+q(t.versionStore.client_version),1)],2)),[[g],[s,t.versionStore.is_update_available?`アップデートがあります (version ${t.versionStore.latest_version})`:"",void 0,{top:!0}]])])])]),i(y)])}const jt=E(qt,[["render",Gt],["__scopeId","data-v-7bf8cf5e"]]);export{Kt as H,jt as N,Lt as V,Tt as u};
