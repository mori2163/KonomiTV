import{d as p,m as l,M as a,a2 as _,u as m,_ as u,k as f,r as h,o as g}from"./index-DJnqFb91.js";import{W as y,P as v}from"./PlayerController-DP7DmjNK.js";import{I as S,a as s}from"./Videos-y6WHFsfm.js";import{u as n}from"./CaptureManager-D8wBIW2O.js";import"./ChannelsStore-Dfb6wZak.js";import"./ssrBoot-DvxYJLiV.js";import"./VCard-CCKEmTaz.js";import"./VRow-B2wsbuYS.js";import"./VDialog-DAC-RvNQ.js";import"./VOverlay-BcNliwIL.js";import"./forwardRefs-B931MWyl.js";import"./dialog-transition-CY4dbePS.js";import"./VSwitch-D2sK-9NJ.js";import"./VTextField-BzKJGGL0.js";import"./VSlider-DyClbt-v.js";import"./swiper-BJe2OGri.js";import"./index-BnYEBiLN.js";import"./CommentMuteSettings--6huL9N0.js";import"./VSelect-BEmwMWVE.js";import"./VDivider-TTn6AwhD.js";import"./manager-B_l_qcot.js";import"./PlayerUtils-BfTyTGZ4.js";import"./vuedraggable.umd-D8tYCO_0.js";import"./Twitter-5ynhFRak.js";import"./Captures-CWH_yI2r.js";let o=null;const $=p({name:"Offline-Watch",components:{Watch:y},computed:{...l(_,n,m)},beforeCreate(){const e=n(),r=_(),t=this.$route.params.download_id;if(t&&r.initialized){const i=r.downloads.find(d=>d.id===t);i&&(e.offline_download=i)}},created(){this.init()},beforeRouteUpdate(e,r,t){this.destroy().then(()=>{this.init(),t()})},beforeUnmount(){this.destroy()},methods:{async init(){if(this.offlineStore.initialized===!1&&await this.offlineStore.initialize(),this.offlineStore.initialization_error!==null){a.error(this.offlineStore.initialization_error),this.$router.push({path:"/offline/"});return}if(this.$route.params.download_id===void 0){this.$router.push({path:"/offline/"});return}const e=this.$route.params.download_id,r=this.offlineStore.downloads.find(t=>t.id===e);if(r===void 0){a.error("指定されたオフライン保存データが見つかりません。"),this.$router.push({path:"/offline/"});return}if(r.status!=="completed"){a.warning("ダウンロードが完了していないため視聴できません。"),this.$router.push({path:"/offline/"});return}this.playerStore.offline_download=r,this.playerStore.recorded_program=this.createRecordedProgram(r);try{o=new v("Video"),await o.init()}catch(t){a.error("プレイヤーの初期化に失敗しました。"),console.error("PlayerController initialization failed:",t),this.$router.push({path:"/offline/"});return}},async destroy(){o!==null&&(await o.destroy(),o=null),this.playerStore.offline_download=null,this.playerStore.recorded_program=s},createRecordedProgram(e){const r={...S,id:e.recorded_program.video_id,status:"Recorded",file_path:e.recorded_program.video_file_path,file_size:e.recorded_program.video_file_size,file_created_at:e.recorded_program.start_time,file_modified_at:e.recorded_program.end_time,recording_start_time:e.recorded_program.start_time,recording_end_time:e.recorded_program.end_time,duration:e.recorded_program.duration,container_format:"MPEG-TS",video_codec:e.is_hevc?"H.265":"H.264",video_codec_profile:"High",video_scan_type:"Interlaced",video_frame_rate:29.97,video_resolution_width:e.recorded_program.video_resolution_width,video_resolution_height:e.recorded_program.video_resolution_height,primary_audio_codec:"AAC-LC",primary_audio_channel:"Stereo",primary_audio_sampling_rate:48e3,secondary_audio_codec:null,secondary_audio_channel:null,secondary_audio_sampling_rate:null,has_key_frames:!0,cm_sections:[],is_tsreplace_encoded:!1,tsreplace_encoded_at:null,original_video_codec:e.is_hevc?"H.265":"H.264",created_at:e.created_at,updated_at:e.updated_at};return{...s,id:e.recorded_program.id,recorded_video:r,recording_start_margin:0,recording_end_margin:0,is_partially_recorded:!1,channel:null,network_id:null,service_id:null,event_id:null,series_id:null,series_broadcast_period_id:null,title:e.recorded_program.title,series_title:e.recorded_program.series_title,episode_number:e.recorded_program.episode_number,subtitle:e.recorded_program.subtitle,description:e.recorded_program.description,detail:{},start_time:e.recorded_program.start_time,end_time:e.recorded_program.end_time,duration:e.recorded_program.duration,is_free:!0,genres:e.recorded_program.genres.map(i=>({major:i.major,middle:i.middle})),primary_audio_type:"2/0モード(ステレオ)",primary_audio_language:"日本語",secondary_audio_type:null,secondary_audio_language:null,created_at:e.created_at,updated_at:e.updated_at}}}});function b(e,r,t,i,d,z){const c=h("Watch",!0);return g(),f(c,{playback_mode:"Video",is_offline:!0})}const Q=u($,[["render",b]]);export{Q as default};
