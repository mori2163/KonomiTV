import{B as y}from"./Breadcrumbs-rpP9fJRy.js";import{H as B,N as I}from"./Navigation-CLeNhjXZ.js";import{R as M,a as A}from"./ReservationList-qvfW2Olm.js";import{S as L}from"./SPHeaderBar-CMgaOGj9.js";import{d as S,q as l,x as U,y as E,c as H,a as n,b as u,n as N,L as c,o as O,_ as P}from"./index-DIoHDJyy.js";import"./ssrBoot-DE4CZP4n.js";import"./VSwitch-BD5z6_Uf.js";import"./VTextField-C-Za9VNV.js";import"./transition-BCy9OjHF.js";import"./VSelectionControl-0miD2NWO.js";import"./VChip-Bjc-8d6O.js";import"./VAvatar-DnGFScgN.js";import"./VSlider-ByUk-Vt6.js";import"./VSelect-DQKV9enS.js";import"./VDivider-BuR3Ai71.js";import"./VDialog-DSX_zm78.js";import"./VCard-BLU3Ftcd.js";import"./VPagination-GUqtSlQq.js";const b={class:"route-container"},F={class:"reservations-home-container-wrapper"},T={class:"reservations-home-container"},x=30*1e3,C=10,D=S({__name:"Home",setup(V){const m=l([]),p=l(0),o=l(!0),r=l(null),d={upcomingReservations:async()=>{const e=await A.fetchReservations();if(e){const a=c(),v=e.reservations.filter(s=>{const t=c(s.program.start_time),R=t.isAfter(a)&&t.isBefore(a.add(24,"hours")),w=s.is_recording_in_progress;return R||w}).sort((s,t)=>s.is_recording_in_progress&&!t.is_recording_in_progress?-1:!s.is_recording_in_progress&&t.is_recording_in_progress?1:c(s.program.start_time).valueOf()-c(t.program.start_time).valueOf());p.value=v.length,m.value=v.slice(0,C)}}},i=async()=>{try{await Promise.all(Object.values(d).map(e=>e())),o.value=!1}catch(e){console.error("Failed to update reservation sections:",e),o.value=!1}},_=e=>{console.log(`Reservation ${e} deleted, refreshing list...`),i()},g=()=>{r.value===null&&(i(),r.value=window.setInterval(i,x))},f=()=>{r.value!==null&&(clearInterval(r.value),r.value=null)};return U(()=>{g()}),E(()=>{f()}),(e,a)=>(O(),H("div",b,[n(B),u("main",null,[n(I),u("div",F,[n(L),u("div",T,[n(y,{crumbs:[{name:"ホーム",path:"/"},{name:"録画予約",path:"/reservations/",disabled:!0}]}),n(M,{class:N(["reservations-home-container__upcoming-reservations",{"reservations-home-container__upcoming-reservations--loading":m.value.length===0&&o.value}]),title:"放送が近い録画予約",reservations:m.value,total:p.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,isLoading:o.value,showEmptyMessage:!o.value,emptyIcon:"fluent:timer-20-regular",emptyMessage:"まだ録画予約がありません。",emptySubMessage:"番組表から録画予約を追加できます。",showRefreshButton:!0,onRefresh:i,onMore:a[0]||(a[0]=h=>e.$router.push("/reservations/all")),onDelete:_},null,8,["class","reservations","total","isLoading","showEmptyMessage"])])])])]))}}),ne=P(D,[["__scopeId","data-v-3d9cd741"]]);export{ne as default};
