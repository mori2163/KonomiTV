import{a4 as ve,a5 as fe,a7 as oe,d as he,cA as D,dr as xe,q as I,c as P,e as ne,a as v,b as u,t as z,k as ce,h as Y,V as Z,Z as Ye,d7 as _e,F as $e,g as Ie,r as Re,l as A,n as le,o as E,_ as ge,E as ke,x as Te,y as Ce}from"./index-BpLevayy.js";import{B as Ae}from"./Breadcrumbs-D_M9sT3w.js";import{H as Ee,N as Ve}from"./Navigation-Ci5xqdiJ.js";import{V as Be}from"./VDialog-Babl3Qa3.js";import{V as me}from"./VChip-awc9kFDa.js";import{a as He,V as Fe,b as Pe,c as Oe}from"./VCard-CRJDcU4D.js";import{V as Ne}from"./ssrBoot-BFtXHDOB.js";import{S as ze}from"./SPHeaderBar-DwW0vzTH.js";import"./index-CW8VOP8v.js";import"./VAvatar-CQvF-yTT.js";var pe={exports:{}};(function(w,l){(function(o,g){w.exports=g()})(fe,function(){return function(o,g,S){o=o||{};var p=g.prototype,h={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function M(m,s,b,x){return p.fromToBase(m,s,b,x)}S.en.relativeTime=h,p.fromToBase=function(m,s,b,x,n){for(var a,R,e,t=b.$locale().relativeTime||h,r=o.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],i=r.length,y=0;y<i;y+=1){var _=r[y];_.d&&(a=x?S(m).diff(b,_.d,!0):b.diff(m,_.d,!0));var L=(o.rounding||Math.round)(Math.abs(a));if(e=a>0,L<=_.r||!_.r){L<=1&&y>0&&(_=r[y-1]);var d=t[_.l];n&&(L=n(""+L)),R=typeof d=="string"?d.replace("%d",L):d(L,s,_.l,e);break}}if(s)return R;var c=e?t.future:t.past;return typeof c=="function"?c(R):c.replace("%s",R)},p.to=function(m,s){return M(m,s,this,!0)},p.from=function(m,s){return M(m,s,this)};var f=function(m){return m.$u?S.utc():S()};p.toNow=function(m){return this.to(f(this),m)},p.fromNow=function(m){return this.from(f(this),m)}}})})(pe);var Ue=pe.exports;const Ze=ve(Ue);var ye={exports:{}};(function(w,l){(function(o,g){w.exports=g()})(fe,function(){var o={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},g=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,S=/\d/,p=/\d\d/,h=/\d\d?/,M=/\d*[^-_:/,()\s\d]+/,f={},m=function(e){return(e=+e)+(e>68?1900:2e3)},s=function(e){return function(t){this[e]=+t}},b=[/[+-]\d\d:?(\d\d)?|Z/,function(e){(this.zone||(this.zone={})).offset=function(t){if(!t||t==="Z")return 0;var r=t.match(/([+-]|\d\d)/g),i=60*r[1]+(+r[2]||0);return i===0?0:r[0]==="+"?-i:i}(e)}],x=function(e){var t=f[e];return t&&(t.indexOf?t:t.s.concat(t.f))},n=function(e,t){var r,i=f.meridiem;if(i){for(var y=1;y<=24;y+=1)if(e.indexOf(i(y,0,t))>-1){r=y>12;break}}else r=e===(t?"pm":"PM");return r},a={A:[M,function(e){this.afternoon=n(e,!1)}],a:[M,function(e){this.afternoon=n(e,!0)}],Q:[S,function(e){this.month=3*(e-1)+1}],S:[S,function(e){this.milliseconds=100*+e}],SS:[p,function(e){this.milliseconds=10*+e}],SSS:[/\d{3}/,function(e){this.milliseconds=+e}],s:[h,s("seconds")],ss:[h,s("seconds")],m:[h,s("minutes")],mm:[h,s("minutes")],H:[h,s("hours")],h:[h,s("hours")],HH:[h,s("hours")],hh:[h,s("hours")],D:[h,s("day")],DD:[p,s("day")],Do:[M,function(e){var t=f.ordinal,r=e.match(/\d+/);if(this.day=r[0],t)for(var i=1;i<=31;i+=1)t(i).replace(/\[|\]/g,"")===e&&(this.day=i)}],w:[h,s("week")],ww:[p,s("week")],M:[h,s("month")],MM:[p,s("month")],MMM:[M,function(e){var t=x("months"),r=(x("monthsShort")||t.map(function(i){return i.slice(0,3)})).indexOf(e)+1;if(r<1)throw new Error;this.month=r%12||r}],MMMM:[M,function(e){var t=x("months").indexOf(e)+1;if(t<1)throw new Error;this.month=t%12||t}],Y:[/[+-]?\d+/,s("year")],YY:[p,function(e){this.year=m(e)}],YYYY:[/\d{4}/,s("year")],Z:b,ZZ:b};function R(e){var t,r;t=e,r=f&&f.formats;for(var i=(e=t.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(V,B,C){var T=C&&C.toUpperCase();return B||r[C]||o[C]||r[T].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(H,F,O){return F||O.slice(1)})})).match(g),y=i.length,_=0;_<y;_+=1){var L=i[_],d=a[L],c=d&&d[0],k=d&&d[1];i[_]=k?{regex:c,parser:k}:L.replace(/^\[|\]$/g,"")}return function(V){for(var B={},C=0,T=0;C<y;C+=1){var H=i[C];if(typeof H=="string")T+=H.length;else{var F=H.regex,O=H.parser,j=V.slice(T),U=F.exec(j)[0];O.call(B,U),V=V.replace(U,"")}}return function(N){var G=N.afternoon;if(G!==void 0){var $=N.hours;G?$<12&&(N.hours+=12):$===12&&(N.hours=0),delete N.afternoon}}(B),B}}return function(e,t,r){r.p.customParseFormat=!0,e&&e.parseTwoDigitYear&&(m=e.parseTwoDigitYear);var i=t.prototype,y=i.parse;i.parse=function(_){var L=_.date,d=_.utc,c=_.args;this.$u=d;var k=c[1];if(typeof k=="string"){var V=c[2]===!0,B=c[3]===!0,C=V||B,T=c[2];B&&(T=c[2]),f=this.$locale(),!V&&T&&(f=r.Ls[T]),this.$d=function(j,U,N,G){try{if(["x","X"].indexOf(U)>-1)return new Date((U==="X"?1e3:1)*j);var $=R(U)(j),X=$.year,q=$.month,we=$.day,De=$.hours,Le=$.minutes,Se=$.seconds,be=$.milliseconds,ue=$.zone,de=$.week,J=new Date,K=we||(X||q?1:J.getDate()),ee=X||J.getFullYear(),Q=0;X&&!q||(Q=q>0?q-1:J.getMonth());var W,te=De||0,re=Le||0,se=Se||0,ae=be||0;return ue?new Date(Date.UTC(ee,Q,K,te,re,se,ae+60*ue.offset*1e3)):N?new Date(Date.UTC(ee,Q,K,te,re,se,ae)):(W=new Date(ee,Q,K,te,re,se,ae),de&&(W=G(W).week(de).toDate()),W)}catch{return new Date("")}}(L,k,d,r),this.init(),T&&T!==!0&&(this.$L=this.locale(T).$L),C&&L!=this.format(k)&&(this.$d=new Date("")),f={}}else if(k instanceof Array)for(var H=k.length,F=1;F<=H;F+=1){c[1]=k[F-1];var O=r.apply(this,c);if(O.isValid()){this.$d=O.$d,this.$L=O.$L,this.init();break}F===H&&(this.$d=new Date(""))}else y.call(this,_)}}})})(ye);var je=ye.exports;const Ge=ve(je);class Me{static async fetchReservations(){const l=await oe.get("/recording/reservations");return l.type==="error"?(oe.showGenericError(l,"録画予約一覧を取得できませんでした。"),null):l.data}static async addReservation(l){return console.warn("addReservation API は未実装です"),!1}static async updateReservation(l,o){return console.warn("updateReservation API は未実装です"),!1}static async deleteReservation(l){const o=await oe.delete(`/recording/reservations/${l}`);if(o.type==="error"){let g=`録画予約 (ID: ${l}) の削除に失敗しました。`;return o.data&&o.data.detail&&(typeof o.data.detail=="string"?g=o.data.detail:Array.isArray(o.data.detail)&&o.data.detail.length>0&&(g=o.data.detail[0].msg||g)),{detail:g}}return o.status===204?!0:{detail:`録画予約 (ID: ${l}) の削除中に予期せぬエラーが発生しました。 (Status: ${o.status})`}}}const qe={class:"reservation-list"},Qe={key:0,class:"reservation-list__header"},We={class:"reservation-list__title"},Xe={class:"reservation-list__actions"},Je={key:1,class:"reservation-list__loading"},Ke={key:2,class:"reservation-list__empty"},et={class:"reservation-list__empty-message"},tt=["innerHTML"],rt=["innerHTML"],st={key:3,class:"reservation-list__table-container"},at={class:"reservation-list__table"},ot={class:"reservation-list__channel"},nt={class:"reservation-list__program"},it={class:"reservation-list__time"},lt={class:"reservation-list__status"},ut={class:"reservation-list__actions"},dt=he({__name:"ReservationList",props:{reservations:{type:Array,required:!0},total:{type:Number,required:!0},title:{type:String,default:""},isLoading:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{type:String,default:"mdi-calendar-blank"},emptyMessage:{type:String,default:"現在、録画予約はありません。"},emptySubMessage:{type:String,default:"番組表から録画予約を追加できます。"},showMoreButton:{type:Boolean,default:!1}},emits:["more","delete"],setup(w,{emit:l}){D.extend(Ze),D.extend(Ge),D.locale("ja");const o=xe(),g=n=>D(n).format("YYYY年MM月DD日 HH:mm"),S=l,p=n=>n.is_recording_in_progress?"録画中":n.recording_availability!=="Full"?"競合":D(n.program.end_time).isBefore(D())?"終了":"予約済み",h=n=>n.is_recording_in_progress?"primary":n.recording_availability!=="Full"?"error":D(n.program.end_time).isBefore(D())?"grey":"success",M=I(!1),f=I(null),m=I(""),s=I(!1),b=n=>{f.value=n.id,m.value=n.program.title,M.value=!0},x=async()=>{if(f.value!==null){s.value=!0;try{const n=await Me.deleteReservation(f.value);n===!0?(o.show("success","予約を削除しました。"),S("delete",f.value)):typeof n=="object"&&n.detail?o.show("error",`予約の削除に失敗しました。${n.detail}`):o.show("error","予約の削除に失敗しました。")}catch(n){console.error("Failed to delete reservation:",n),o.show("error","予約の削除に失敗しました。")}finally{s.value=!1,M.value=!1}}};return(n,a)=>{const R=Re("Icon");return E(),P("div",qe,[w.title?(E(),P("div",Qe,[u("h2",We,z(w.title),1),u("div",Xe,[w.showMoreButton?(E(),ce(Z,{key:0,variant:"text",class:"reservation-list__more",onClick:a[0]||(a[0]=e=>n.$emit("more"))},{default:Y(()=>[a[3]||(a[3]=u("span",{class:"text-primary"},"もっと見る",-1)),v(R,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):ne("",!0)])])):ne("",!0),w.isLoading&&w.reservations.length===0?(E(),P("div",Je,[v(Ye,{indeterminate:"",size:"32"})])):w.showEmptyMessage&&w.reservations.length===0?(E(),P("div",Ke,[v(_e,{size:48,color:"grey"},{default:Y(()=>[A(z(w.emptyIcon||"mdi-calendar-blank"),1)]),_:1}),u("div",et,[u("p",{innerHTML:w.emptyMessage||"近日中の予約はありません。",class:"text-white"},null,8,tt),u("p",{innerHTML:w.emptySubMessage||"番組表から新しい予約を追加できます。",class:"reservation-list__empty-submessage text-white"},null,8,rt)])])):(E(),P("div",st,[u("table",at,[a[5]||(a[5]=u("thead",null,[u("tr",null,[u("th",{class:"reservation-list__table-channel"},"チャンネル"),u("th",{class:"reservation-list__table-program"},"番組名"),u("th",{class:"reservation-list__table-time"},"放送時間"),u("th",{class:"reservation-list__table-status"},"状態"),u("th",{class:"reservation-list__table-actions"},"操作")])],-1)),u("tbody",null,[(E(!0),P($e,null,Ie(w.reservations,e=>(E(),P("tr",{key:e.id,class:le(["reservation-list__row",{"reservation-list__row--conflict":e.recording_availability!=="Full"}])},[u("td",ot,z(e.channel.name),1),u("td",nt,[A(z(e.program.title)+" ",1),e.recording_availability!=="Full"?(E(),ce(me,{key:0,color:"error",size:"x-small",class:"ml-1"},{default:Y(()=>a[4]||(a[4]=[A("競合")])),_:1})):ne("",!0)]),u("td",it,[u("div",null,z(g(e.program.start_time)),1)]),u("td",lt,[v(me,{color:h(e),size:"small"},{default:Y(()=>[A(z(p(e)),1)]),_:2},1032,["color"])]),u("td",ut,[v(Z,{icon:"mdi-delete",variant:"tonal",size:"small",onClick:t=>b(e),loading:f.value===e.id},null,8,["onClick","loading"])])],2))),128))])])])),v(Be,{modelValue:M.value,"onUpdate:modelValue":a[2]||(a[2]=e=>M.value=e),"max-width":"450"},{default:Y(()=>[v(He,null,{default:Y(()=>[v(Fe,{class:"text-h6"},{default:Y(()=>a[6]||(a[6]=[A("予約の削除")])),_:1}),v(Pe,null,{default:Y(()=>[A(" 「"+z(m.value)+"」を削除しますか？",1),a[7]||(a[7]=u("br",null,null,-1)),a[8]||(a[8]=A(" この操作は取り消せません。 "))]),_:1}),v(Oe,null,{default:Y(()=>[v(Ne),v(Z,{color:"secondary",onClick:a[1]||(a[1]=e=>M.value=!1)},{default:Y(()=>a[9]||(a[9]=[A("キャンセル")])),_:1}),v(Z,{color:"error",onClick:x,loading:s.value},{default:Y(()=>a[10]||(a[10]=[A("削除")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),ie=ge(dt,[["__scopeId","data-v-9ddeb9dd"]]),ct={class:"route-container"},mt={class:"reservations-home-container-wrapper"},vt={class:"reservations-home-container"},ft={class:"reservations-home-container__header"},ht=30*1e3,_t=5,gt=5,pt=10,yt=he({__name:"Home",setup(w){const l=I(!0),o=I(null),g=I([]),S=I(0),p=I([]),h=I(0),M=I([]),f=I(0),m=ke(()=>l.value?[]:[...M.value].sort((t,r)=>D(r.program.start_time).valueOf()-D(t.program.start_time).valueOf()).slice(0,pt)),s=async()=>{l.value=!0;const t=await Me.fetchReservations();if(t){const r=D(),i=t.reservations;f.value=t.total,M.value=i;const y=i.filter(d=>{const c=D(d.program.end_time);return c.isBefore(r)&&c.isAfter(r.subtract(24,"hours"))}).sort((d,c)=>D(c.program.end_time).valueOf()-D(d.program.end_time).valueOf());h.value=y.length,p.value=y.slice(0,gt);const _=new Set(y.map(d=>d.id)),L=i.filter(d=>{if(_.has(d.id))return!1;const c=D(d.program.start_time),k=c.isAfter(r)&&c.isBefore(r.add(24,"hours")),V=d.is_recording_in_progress;return k||V}).sort((d,c)=>d.is_recording_in_progress&&!c.is_recording_in_progress?-1:!d.is_recording_in_progress&&c.is_recording_in_progress?1:D(d.program.start_time).valueOf()-D(c.program.start_time).valueOf());S.value=L.length,g.value=L.slice(0,_t)}else b();l.value=!1},b=()=>{g.value=[],S.value=0,p.value=[],h.value=0,M.value=[],f.value=0},x=async()=>{if(!l.value)try{await s()}catch(t){console.error("Failed to update reservation sections:",t),b()}},n=()=>{e(),x().finally(()=>{R()})},a=t=>{console.log(`Reservation ${t} deleted, refreshing list...`),n()},R=()=>{o.value===null&&(l.value||x(),o.value=window.setInterval(x,ht))},e=()=>{o.value!==null&&(clearInterval(o.value),o.value=null)};return Te(()=>{s(),R()}),Ce(()=>{e()}),(t,r)=>(E(),P("div",ct,[v(Ee),u("main",null,[v(Ve),u("div",mt,[v(ze),u("div",vt,[u("div",ft,[v(Ae,{crumbs:[{name:"ホーム",path:"/"},{name:"予約",path:"/reservations/",disabled:!0}]}),v(Z,{icon:"",variant:"flat",class:"ml-auto",onClick:n,loading:l.value},{default:Y(()=>[v(_e,null,{default:Y(()=>r[3]||(r[3]=[A("mdi-refresh")])),_:1})]),_:1},8,["loading"])]),v(ie,{class:le(["reservations-home-container__upcoming-reservations",{"reservations-home-container__upcoming-reservations--loading":g.value.length===0&&l.value}]),title:"近日中の予約・録画中",reservations:g.value,total:S.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,isLoading:l.value,showEmptyMessage:!l.value,emptyIcon:"mdi-motion-play-outline",emptyMessage:"近日中の予約や録画中の番組はありません。",emptySubMessage:"",onMore:r[0]||(r[0]=i=>t.$router.push("/reservations/all")),onDelete:a},null,8,["class","reservations","total","isLoading","showEmptyMessage"]),v(ie,{class:le(["reservations-home-container__recently-finished-reservations",{"reservations-home-container__recently-finished-reservations--loading":p.value.length===0&&l.value}]),title:"24時間以内に終了した予約",reservations:p.value,total:h.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,isLoading:l.value,showEmptyMessage:!l.value,emptyIcon:"mdi-history",emptyMessage:"24時間以内に終了した予約はありません。",emptySubMessage:"",onMore:r[1]||(r[1]=i=>t.$router.push("/reservations/all")),onDelete:a},null,8,["class","reservations","total","isLoading","showEmptyMessage"]),v(ie,{class:"reservations-home-container__all-reservations",title:"すべての予約",reservations:m.value,total:f.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,isLoading:l.value,showEmptyMessage:!l.value,emptyIcon:"mdi-calendar-check-outline",emptyMessage:"録画予約はまだありません。",emptySubMessage:"番組表などから録画予約を行ってください。",onMore:r[2]||(r[2]=i=>t.$router.push("/reservations/all")),onDelete:a},null,8,["reservations","total","isLoading","showEmptyMessage"])])])])]))}}),kt=ge(yt,[["__scopeId","data-v-741e6c49"]]);export{kt as default};
